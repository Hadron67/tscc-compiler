!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.jscc={})}(this,function(t){"use strict";var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function n(t,n){e(t,n);function r(){this.constructor=t}t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=32,s=function(){function t(t){this._size=t,this._s=new Array(Math.ceil(t/r));for(var e=0;e<this._s.length;e++)this._s[e]=0}return t.prototype.add=function(t){var e=Math.floor(t/r),n=t-e*r,s=this._s[e];return this._s[e]|=1<<n,s!==this._s[e]},t.prototype.addAll=function(){for(var t=0;t<this._s.length;t++)this._s[t]=-1},t.prototype.remove=function(t){var e=Math.floor(t/r),n=t-e*r,s=this._s[e];return this._s[e]&=~(1<<n),s!==this._s[e]},t.prototype.removeAll=function(){for(var t=0;t<this._s.length;t++)this._s[t]=0},t.prototype.contains=function(t){var e=Math.floor(t/r),n=t-e*r;return 0!=(this._s[e]&1<<n)},t.prototype.union=function(t,e){for(var n=!1,r=0;r<this._s.length;r++){var s=this._s[r],i=t._s[r];e&&(i&=e._s[r]),this._s[r]|=i,n=this._s[r]!==s||n}return n},t.prototype.hasIntersection=function(t){for(var e=0;e<this._s.length;e++)if(0!=(this._s[e]&t._s[e]))return!0;return!1},t.prototype.equals=function(t){for(var e=0;e<this._s.length;e++)if(this._s[e]!==t._s[e])return!1;return!0},t.prototype.forEach=function(t){for(var e=0;e<this._size;e++)this.contains(e)&&t(e)},t.prototype.hash=function(){for(var t="",e=0;e<this._s.length;e++)t+=this._s[e].toString(16)+"-";return t},t}(),i="    ",a={assert:function(t){if(!t)throw new Error("Assertion failed")},log:function(t){}};function o(t,e){return t===h.oo&&e!==h.oo||t!==h._oo&&e===h._oo||t>e?1:t===h._oo&&e!==h._oo||t!==h.oo&&e===h.oo||t<e?-1:0}var h;(c=h||(h={})).oo="oo",c._oo="-oo";var c,l=function(){function t(t,e){this.dataSet=null,this.a=t,this.b=e}return t.prototype.insertBefore=function(t,e,n){if(this.parent.isValid(this)&&!this.parent.noMerge&&this.a===e+1)return this.a=t,this;var r=this.parent.createInterval(t,e,n);return r.prev=this.prev,r.next=this,this.prev.next=r,this.prev=r,r},t.prototype.contains=function(t){return o(this.a,t)<=0&&o(this.b,t)>=0},t.prototype.overlaps=function(t,e){return!(o(t,this.b)>0||o(e,this.a)<0)},t.prototype.insertAfter=function(t,e,n){if(this.parent.isValid(this)&&!this.parent.noMerge&&this.b===t-1)return this.b=e,this;var r=this.parent.createInterval(t,e,n);return r.prev=this,r.next=this.next,this.next.prev=r,this.next=r,r},t.prototype.splitLeft=function(t){if(o(t,this.a)>0){var e=this.insertBefore(this.a,t-1);return this.parent.noMerge&&e.dataSet.union(this.dataSet),this.a=t,e}return this},t.prototype.splitRight=function(t){if(o(t,this.b)<0){var e=this.insertAfter(t+1,this.b);return this.parent.noMerge&&e.dataSet.union(this.dataSet),this.b=t,e}return this},t.prototype.remove=function(){return this.prev.next=this.next,this.next.prev=this.prev,this},t.prototype.checkMerge=function(){return this.a!==h._oo&&null!==this.prev.a&&this.a===this.prev.b+1&&(this.a=this.prev.a,this.prev.remove()),this.b!==h.oo&&null!==this.next.a&&this.b===this.next.a-1&&(this.b=this.next.b,this.next.remove()),this},t.prototype.toString=function(t){var e="";function n(t){return t===h.oo?"+oo":t===h._oo?"-oo":t.toString()}var r=(t||n)(this.a),s=(t||n)(this.b);return this.a===this.b?e+=r:(e+=this.a===h._oo?"("+r:"["+r,e+=",",e+=this.b===h.oo?s+")":s+"]"),this.dataSet&&(e+=this.dataSet.toString()),e},t}();function u(t,e){if(o(t,e)>0)throw new Error('illegal argument: "a"('+t+') must be no more than "b"('+e+")")}var p=function(){function t(t){this.head=new l(0,0),this.head.parent=this,this.tail=new l(null,null),this.tail.parent=this,this.head.next=this.tail,this.tail.prev=this.head,this.noMerge=void 0!==t,this.dataSetConstructor=t||null}return t.prototype.isValid=function(t){return t!==this.head&&t!==this.tail},t.prototype.createInterval=function(t,e,n){void 0===n&&(n=null);var r=new l(t,e);return r.parent=this,this.dataSetConstructor&&(r.dataSet=this.dataSetConstructor()),n&&r.dataSet.add(n),r},t.prototype.fitPoint=function(t,e){for(var n=this.head;n!==this.tail;n=n.next)if((n===this.head||o(t,n.b)>0)&&(n.next===this.tail||o(e,n.next.a)<0))return n;return null},t.prototype.overlaped=function(t,e){for(var n=null,r=null,s=this.head.next;s!==this.tail&&!s.overlaps(t,e);s=s.next);if(s===this.tail)return null;for(n=r=s;s!==this.tail&&s.overlaps(t,e);s=s.next)r=s;return[n,r]},t.prototype.add=function(t,e,n){void 0===e&&(e=t);var r=this.noMerge;u(t,e);var s=this.overlaped(t,e);if(null===s)this.fitPoint(t,e).insertAfter(t,e,n);else if(r){s[0].contains(t)?s[0].splitLeft(t):s[0].insertBefore(t,s[0].a-1,n),s[1].contains(e)?s[1].splitRight(e):s[1].insertAfter(s[1].b+1,e,n);for(var i=s[0];i!==s[1];i=i.next)i.dataSet.add(n),i.b+1<i.next.a&&i.insertAfter(i.b+1,i.next.a-1,n);s[1].dataSet.add(n)}else{var a=o(t,s[0].a)<0?t:s[0].a,h=o(e,s[1].b)>0?e:s[1].b;s[0].a=a,s[0].b=h,s[0].next=s[1].next,s[1].next.prev=s[0],s[0].checkMerge()}return this},t.prototype.remove=function(t,e){u(t,e);var n=this.overlaped(t,e);return null!==n&&(n[0].contains(t)&&n[0].splitLeft(t),n[1].contains(e)&&n[1].splitRight(e),n[0].prev.next=n[1].next,n[1].next.prev=n[0].prev),this},t.prototype.removeAll=function(){return this.head.next=this.tail,this.tail.prev=this.head,this},t.prototype.forEach=function(t){for(var e=this.head.next;e!==this.tail;e=e.next)t(e.a,e.b,e);return this},t.prototype.union=function(t){for(var e=t.head.next;e!==t.tail;e=e.next)this.add(e.a,e.b);return this},t.prototype.contains=function(t){for(var e=this.head.next;e!==this.tail;e=e.next)if(e.contains(t))return!0;return!1},t.prototype.toString=function(t){for(var e="",n=!1,r=this.head.next;r!==this.tail;r=r.next)n&&(e+=","),n=!0,e+=r.toString(t);return""===e?"phi":e},t}(),f=h.oo,d=h._oo,_=function(t){n(e,t);function e(e){return t.call(this,e)||this}return e.prototype.addAll=function(){t.prototype.add.call(this,0,h.oo)},e.prototype.toString=function(){return t.prototype.toString.call(this,function(t){return t!==f&&t!==d?t>=32&&t<=126?"'"+String.fromCharCode(t)+"'":"\\x"+t.toString(16):t===f?"oo":"-oo"})},e}(p),v="\n",g=function(){function t(){}return t.prototype.writeln=function(t){t&&this.write(t),this.write(v)},t}(),m=function(t){n(e,t);function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.s="",e}return e.prototype.write=function(t){this.s+=t},e.prototype.reset=function(){this.s=""},e}(g);function k(t){var e=[];return{peek:function(){return e.length>0?e[e.length-1]:t.peek()},next:function(){return e.length>0?e.pop():t.next()},backup:function(t){e.push(t)}}}var b,S=Object.freeze({endl:v,OutputStream:g,StringOS:m,StringIS:function(t){var e=0;return{peek:function(){return t.charAt(e)||null},next:function(){var t=this.peek();return e++,t}}},biss:k});(y=b||(b={}))[y.START=0]="START",y[y.END=1]="END",y[y.NONE=2]="NONE";var y,x=0,A=function(t){n(e,t);function e(){var n=t.call(this,0)||this;return Object.setPrototypeOf(n,e.prototype),n}return e.prototype.add=function(t){for(var e=0;e<this.length;e++){if(t===this[e])return}this.length>x&&(x=this.length),this.push(t)},e.prototype.union=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this.add(r)}},e.prototype.toArray=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];t.push(n)}return t},e}(Array),E=function(){return function(t,e){this.chars=new _,this.from=t,this.to=e}}(),w=function(){return function(){this.priority=0,this.id=0,this.data=null}}(),T=function(){function t(t){this.valid=!1,this.arcs=[],this.epsilons=[],this.index=0,this.isStart=!1,this.isEnd=!1,this.marker=!1,this.endAction=null,this.endAction=t||null}return t.prototype.findArc=function(t){for(var e=0,n=this.arcs;e<n.length;e++){var r=n[e];if(r.to===t)return r}return null},t.prototype.to=function(t){var e=this.findArc(t);return null===e&&(e=new E(this,t),this.arcs.push(e)),t.valid=!0,e},t.prototype.epsilonTo=function(t){this.epsilons.push(t)},t.prototype.iterator=function(t){void 0===t&&(t=!1);var e=[this],n=[this];return this.marker=!0,function(){if(e.length>0){var r=e.pop();if(!t)for(var s=0,i=r.arcs;s<i.length;s++){var a=i[s].to;a.marker||(e.push(a),n.push(a),a.marker=!0)}for(var o=0,h=r.epsilons;o<h.length;o++){var c=h[o];c.marker||(e.push(c),n.push(c),c.marker=!0)}return r}for(var l=0,u=n;l<u.length;l++){u[l].marker=!1}return null}},t.prototype.forEach=function(t,e){void 0===e&&(e=!1);var n=[this],r=[this];for(this.marker=!0;n.length>0;){var s=n.pop();if(t(s),!e)for(var i=0,a=s.arcs;i<a.length;i++){var o=a[i].to;o.marker||(n.push(o),r.push(o),o.marker=!0)}for(var h=0,c=s.epsilons;h<c.length;h++){var l=c[h];l.marker||(n.push(l),r.push(l),l.marker=!0)}}for(var u=0,p=r;u<p.length;u++){p[u].marker=!1}},t.prototype.number=function(){var t=0;this.forEach(function(e){e.index=t++})},t.prototype.print=function(t,e){void 0===e&&(e=!0);function n(t){var e="";e+="state "+t.index,t.isStart&&(e+="(start)"),t.endAction&&(e+="(end "+t.endAction.id+")"),e+=v;for(var n=0;n<t.arcs.length;n++){var r=t.arcs[n];e+=""+i+r.chars.toString()+" -> state "+r.to.index+v}if(t.epsilons.length>0){e+=i+"epsilon: ";for(n=0;n<t.epsilons.length;n++)n>0&&(e+=","),e+=t.epsilons[n].index.toString();e+=v}return e}e?this.forEach(function(e){t.write(n(e))}):t.write(n(this))},t.prototype.toString=function(t){void 0===t&&(t=!0);var e=new m;return this.print(e,t),e.s},t.prototype.copyEndFrom=function(t){null!==t.endAction&&(null!==this.endAction?this.endAction.priority<t.endAction.priority&&(this.endAction=t.endAction):this.endAction=t.endAction)},t.prototype.removeEpsilons=function(){var t=[this];this.forEach(function(e){e.valid&&t.push(e)});for(var e=0;e<t.length;e++){var n=t[e];n.forEach(function(t){if(t!==n){for(var e=0;e<t.arcs.length;e++){var r=t.arcs[e];n.to(r.to).chars.union(r.chars)}n.copyEndFrom(t)}},!0),n.epsilons.length=0}for(e=0;e<t.length;e++)t[e].index=e},t.prototype.count=function(){var t=0;return this.forEach(function(){t++}),t},t.prototype.size=function(){var t=0;return this.forEach(function(){t++}),t},t.prototype.allChars=function(t){for(var e=0;e<this.arcs.length;e++){var n=this.arcs[e];n.chars.forEach(function(e,r){t.add(e,r,n.to)})}},t.prototype.getState=function(t){for(var e=0;e<this.arcs.length;e++){var n=this.arcs[e];if(n.chars.contains(t))return n.to}return null},t.prototype.hasArc=function(){return this.arcs.length>0},t.prototype.clone=function(){},t.prototype.toDFA=function(){var t={},e=[],n=0,r=this.count(),s=new _(function(){return new A}),i=new C(r,[this]);i.index=n++,e.push(i),t[i.hash()]=i;for(var a=[i];a.length>0;){var o=a.shift();s.removeAll(),o.allChars(s),s.forEach(function(s,i,h){var c=new C(r,h.dataSet.toArray()),l=c.hash();t[l]?c=t[l]:(t[l]=c,a.push(c),c.index=n++,e.push(c)),o.to(c).chars.add(s,i)})}return i.release(),{head:i,states:e}},t}(),C=function(t){n(e,t);function e(e,n){var r=t.call(this)||this;r.isEnd=r.isStart=!1,r.valid=!0,r.states=n,r.stateSet=new s(e);for(var i=0;i<n.length;i++)r.stateSet.add(n[i].index),r.copyEndFrom(n[i]),r.isStart=r.isStart||n[i].isStart;return r}return e.prototype.hash=function(){return this.stateSet.hash()},e.prototype.allChars=function(t){for(var e=0;e<this.states.length;e++)this.states[e].allChars(t)},e.prototype.forEach=function(e){t.prototype.forEach.call(this,e)},e.prototype.release=function(){this.forEach(function(t){t.states.length=0})},e}(T),L=function(){function t(t){this.states=t,this.start=t[0]}return t.prototype.print=function(t){for(var e=0,n=this.states;e<n.length;e++){n[e].print(t,!1),t.writeln()}},t.prototype.toString=function(){for(var t="",e=0;e<this.states.length;e++)t+=this.states[e].toString()+"\n";return t},t.prototype.matcher=function(t){var e,n=k(t),r=[],s=[],i=null,a=n.peek();function o(){null!==i&&r.push(a),s.push(a),n.next(),a=n.peek()}function h(){for(e=i,i=null;r.length>0;)n.backup(r.pop()),s.pop()}var c=this;return function(){a=n.peek(),e=c.start,s.length=0,r.length=0,i=null;for(var t;;)if(null!==e.endAction){if(!e.hasArc())return{matched:s.join(""),action:e.endAction};if(null===(t=null!==a?e.getState(a.charCodeAt(0)):null))return{matched:s.join(""),action:e.endAction};r.length=0,i=e,e=t,o()}else{if(null===(t=null!==a?e.getState(a.charCodeAt(0)):null)){if(null!==i)return h(),{matched:s.join(""),action:e.endAction};if(null===a)return null;throw new Error('unexpected character "'+a+'"')}e=t,o()}}},t}(),R=function(){function t(t,e){void 0===e&&(e="Error"),this.msg=t,this.type=e}return t.prototype.toString=function(t){void 0===t&&(t={});var e=!!t.escape,n=this.type;return t.typeClass&&(n='<span class="'+t.typeClass+'">'+n+"</span>"),n+=": ",n+=e?this.msg.replace(/</g,"&lt").replace(/>/g,"&gt"):this.msg},t}(),N=function(t){n(e,t);function e(e,n){var r=t.call(this,e,"CompilationError")||this;return r.line=n,r}return e.prototype.toString=function(e){return t.prototype.toString.call(this,e)+" (at line "+this.line+")"},e}(R),I=function(t){n(e,t);function e(e){return t.call(this,e,"Warning")||this}return e}(R),V=function(t){n(e,t);function e(e){return t.call(this,e,"PatternException")||this}return e}(R);function D(t,e){var n=[{sptr:0,s:t,name:""}],r=n[0];return{next:function(){r.sptr++,r.sptr>=r.s.length&&(n.length>1&&n.pop(),r=n[n.length-1])},peek:function(){return r.s[r.sptr]||null},pushTo:function(t){var s=e?e[t]:null;if(!s)throw new V('undefined name "'+t+'"');!function(t){for(var e=0;e<n.length;e++)if(n[e].name===t)throw new V('cannot use pattern "'+t+'" which leads to loop reference')}(t),n.push({sptr:0,s:"("+s+")",name:t}),r=n[n.length-1]}}}function O(t,e){void 0===e&&(e={});var n=D(t,e),r=n.peek();function s(){n.next(),r=n.peek()}function i(t){if(null===r)throw new V("unexpected end of string"+(t?", "+t:""))}function a(){return new T}function o(){return null===r}function h(t){if(r!==t)throw new V('unexpected character "'+r+'",expecting "'+t+'"');s()}function c(t){for(var e=l(t);!o()&&"|"===r;){s();var n=a();t.epsilonTo(n),l(n).epsilonTo(e)}return e}function l(t){var e=t;do{e=u(e)}while(!o()&&"|"!==r&&")"!==r);return e}function u(t){var e=a();t.epsilonTo(e);var u=function(t){{if(i(),"("===r){s();var e=c(t);return h(")"),e}if("."===r){s();var e=a();return t.to(e).chars.addAll(),e}if("["===r){s();var u="^"===r;u&&s();var e=a(),d=t.to(e).chars;for(u&&d.addAll();"]"!==r&&!o();)f(d,u);return h("]"),e}if("{"===r){s();for(var _="";"}"!==r;)i(),_+=r,s();return s(),n.pushTo(_),r=n.peek(),l(t)}var e=a();return t.to(e).chars.add(p()),e}}(e);if("*"===r){s(),u.epsilonTo(e);var d=a();return e.epsilonTo(d),d}if("+"===r){s();var _=a();return u.epsilonTo(_),_.epsilonTo(e),_}if("?"===r){s();var v=a();return e.epsilonTo(v),u.epsilonTo(v),v}return u}function p(){if(i(),"\\"===r){s();var t=r.charCodeAt(0);switch(r){case"t":t="\t";case"n":t="\n";case"r":t="\r";case"x":s();for(var e="";null!==r&&/[0-9a-fA-F]/.test(r);)e+=r,s();return parseInt(e,16);default:t=r}return s(),t.charCodeAt(0)}var n=r.charCodeAt(0);return s(),n}function f(t,e){var n=p(),i=n,a=n;if("-"===r&&(s(),(a=p())<i))throw new V('left hand side must be larger than right hand side in wild card character (got "'+i.toString(16)+'" < "'+a.toString(16)+'")');e?t.remove(i,a):t.add(i,a)}var d=a();d.isStart=!0;return{result:d,tail:c(d)}}function F(t){void 0===t&&(t={});var e=[],n=0;var r=new T;return{lexRule:function(s,i,a,o){var h=new w;h.priority=n++,h.id=i,h.data=a||null;var c=o?function(t){var e=0,n=t.charAt(e);function r(){return new T}var s=r();s.isStart=!0;for(var i=s;null!==n;){var a=r();i.to(a).chars.add(n.charCodeAt(0)),i=a,n=t.charAt(++e)||null}return{result:s,tail:i}}(s):O(s,t);c.tail.endAction=h,r.epsilonTo(c.result),e.push(h)},done:function(){r.removeEpsilons();var t=r.toDFA();return new L(t.states)}}}var U,B=Object.freeze({lexer:function(t,e){var n;n="function"!=typeof t?function(){return t.shift()||null}:t;for(var r=F(e),s=n();null!==s;)r.lexRule(s.regexp,s.id,s.data,s.raw),s=n();return r.done()},lexerBuilder:F}),M=function(t){n(e,t);function e(e){return t.call(this,e)||this}return e.prototype.toString=function(t){var e="",n=!0;this.contains(0)&&(e+='""',n=!1);for(var r=0;r<t.tokenCount;r++)this.contains(r+1)&&(n||(e+=","),e+='"'+t.tokens[r].sym+'"',n=!1);return e},e}(s);(P=U||(U={}))[P.NONE=1]="NONE",P[P.SHIFT=2]="SHIFT",P[P.REDUCE=3]="REDUCE";var P,G,H=function(){function t(t,e){this.marker=0,this.shift=null,this.actionType=U.NONE,this.changed=!0,this.rule=t,this.isKernel=e,this.lah=new M(t.g.tokenCount)}return t.prototype.canShift=function(){return this.rule.rhs.length>this.marker},t.prototype.getShift=function(){return this.rule.rhs[this.marker]},t.prototype.toString=function(t){void 0===t&&(t={});var e=t&&t.showlah||!1,n=t&&t.showTrailer||!1,r="[ "+this.rule.toString(this.marker)+(e?",{ "+this.lah.toString(this.rule.g)+" }":"")+" ]";if(this.isKernel&&(r+="*"),n)switch(this.actionType){case U.NONE:r+="(-)";break;case U.SHIFT:r+="(s"+this.shift.stateIndex+")";break;case U.REDUCE:r+="(r)"}return r},t.prototype.hash=function(){return this.rule.index+"-"+this.marker},t.prototype.hasRRConflictWith=function(t){return this.actionType===U.REDUCE&&t.actionType===U.REDUCE&&this.rule.index!==t.rule.index&&this.lah.hasIntersection(t.lah)},t.prototype.getFollowSet=function(t){var e,n=this.rule.g;for(e=this.marker+1;e<this.rule.rhs.length;e++){var r=this.rule.rhs[e];if(n.isToken(r)){t.add(r+1);break}var s=n.nts[-r-1].firstSet;if(t.union(s),t.remove(0),!s.contains(0))break}e===this.rule.rhs.length&&t.union(this.lah)},t.NULL={},t}(),K=function(){function t(t){this.it={},this.complete=!1,this.index=-1,this.stateIndex=0,this.prev=null,this.next=null,this.merges=[],this.g=t,this.data=this}return t.prototype.add=function(t,e,n,r,s){var i=t.index+"-"+e,a=this.it[i];if(void 0===a){var o=new H(t,n);return o.marker=e,r&&o.lah.union(r),this.it[i]=o,!0}if(r){var h=a.lah.union(r);return s&&h&&a.canShift()&&(a.actionType=U.NONE),h&&(a.changed=!0),h}},t.prototype.contains=function(){},t.prototype.closure=function(){for(var t=!0,e=new M(this.g.tokenCount),n=this;t;){t=!1;for(var r in this.it){var s=this.it[r];if(s.changed&&s.canShift()){var i=s.getShift();i<0&&(e.removeAll(),s.getFollowSet(e),this.g.forEachRuleOfNt(-i-1,function(r){return t=n.add(r,0,!1,e,!1)||t,!1}))}s.changed=!1}}},t.prototype.toString=function(t){var e={showTrailer:t&&t.showTrailer||!1},n="s"+this.stateIndex;if(null!==this.index?n+="(i"+this.index:n+="(i?",this.merges.length>0){n+=",merged from ";for(var r=0;r<this.merges.length;r++)r>0&&(n+=","),n+="i"+this.merges[r]}n+=")"+v;for(var s in this.it)n+=this.it[s].toString(e)+v;return n},t.prototype.kernelHash=function(){var t=0;for(var e in this.it){var n=this.it[e];n.isKernel&&(t+=n.rule.index<<5+n.rule.index+n.marker)}return String(t)},t.prototype.forEach=function(t){for(var e in this.it)t(this.it[e])},t.prototype.canMergeTo=function(t){for(var e in this.it){var n=this.it[e],r=!1,s=!1,i=!1;for(var a in t.it){var o=t.it[a];if(n.rule.index===o.rule.index&&n.marker===o.marker&&(i=n.lah.equals(o.lah),r=n.isKernel&&o.isKernel),s=s||n.hasRRConflictWith(o),o.isKernel&&void 0===this.it[a])return!1}if(n.isKernel&&!r||s&&!i)return!1}return!0},t.prototype.mergeTo=function(t){var e=!1;for(var n in t.it){var r=t.it[n];e=this.add(r.rule,r.marker,r.isKernel,r.lah,!0)||e}return this.merges.push(t.index),e},t}(),j=function(){function t(){this.size=0,this.head={prev:null,next:null,data:null},this.tail={prev:null,next:null,data:null},this.head.next=this.tail,this.tail.prev=this.head}return t.prototype.append=function(t){t.prev=this.tail.prev,t.next=this.tail,this.tail.prev.next=t,this.tail.prev=t,this.size++},t.prototype.pull=function(){var t=this.head.next;return this.head.next=t.next,t.next.prev=this.head,t.prev=t.next=null,this.size--,t.data},t.prototype.isEmpty=function(){return 0===this.size},t.prototype.forEach=function(t){for(var e=this.head.next;e!==this.tail;e=e.next)t(e.data)},t.prototype.remove=function(t){t.next.prev=t.prev,t.prev.next=t.next,this.size--},t.prototype.iterator=function(){var t=this.head,e=this;return function(){return t!==e.tail?(t=t.next).data:null}},t}();(z=G||(G={}))[z.UNDEFINED=0]="UNDEFINED",z[z.LEFT=1]="LEFT",z[z.RIGHT=2]="RIGHT",z[z.NON=3]="NON";var z;function $(t){return null===t.alias?"<"+t.sym+">":'"'+t.alias+'"'}var q,W=function(){function t(t,e){this.defred=null,this.g=t;var n=t.tokenCount,r=t.nts.length;this.stateCount=e,this.shift=new Array(n*e),this.gotot=new Array(r*e);for(var s=0;s<this.shift.length;s++)this.shift[s]=null;for(s=0;s<this.gotot.length;s++)this.gotot[s]=null}return t.prototype.forEachShift=function(t){for(var e=0;e<this.stateCount;e++)for(var n=0;n<this.g.tokens.length;n++){var r=this.lookupShift(e,n);r&&t(r,e,n)}},t.prototype.forEachGoto=function(t){for(var e=0;e<this.stateCount;e++)for(var n=0;n<this.g.nts.length;n++){var r=this.lookupGoto(e,n);r&&t(r,e,n)}},t.prototype.lookupShift=function(t,e){return this.shift[this.g.tokenCount*t+e]},t.prototype.lookupGoto=function(t,e){return this.gotot[this.g.nts.length*t+e]},t.prototype._getDefRed=function(t,e){for(var n=0;n<e.length;n++)e[n]=0;for(var r=0;r<this.g.tokenCount;r++){var s=this.lookupShift(t,r);s&&s.actionType===U.REDUCE&&e[s.rule.index]++}var i=0;for(n=0;n<e.length;n++)e[n]>e[i]&&(i=n);return e[i]>0?i:-1},t.prototype.findDefAct=function(){this.defred=new Array(this.stateCount);for(var t=new Array(this.g.rules.length),e=0;e<this.stateCount;e++){var n=this._getDefRed(e,t);if(this.defred[e]=n,-1!==n)for(var r=0;r<this.g.tokens.length;r++){var s=this.lookupShift(e,r);s&&s.actionType===U.REDUCE&&s.rule.index===n&&(this.shift[this.g.tokenCount*e+r]=null)}}},t}();(Y=q||(q={}))[Y.RR=0]="RR",Y[Y.SR=1]="SR";var Y,Q=function(){function t(){}return t.prototype.toString=function(){return"state "+this.set.stateIndex+", "+t.cNames[this.type]+" conflict:"+v+i+"token: "+$(this.token)+v+i+"used rule: "+this.used.toString()+v+i+"discarded rule: "+this.discarded.toString()},t.cNames=["reduce/reduce","shift/reduce"],t}();function X(t){var e={},n=0;function r(t){var n=t.kernelHash();void 0===e[n]&&(e[n]=[]),e[n].push(t)}function s(t,n){var r=e[t.kernelHash()];if(void 0!==r)for(var s=0;s<r.length&&!n(r[s]);s++);}var i=1,o=new j,h=new j,c=new j;for(o.append(function(t){var e=t.nts[0].rules[0],n=new K(t);n.index=0;var r=new M(t.tokenCount);return r.add(1),n.add(e,0,!0,r,!1),n}(t));!o.isEmpty()||!h.isEmpty();){var l=null;if(!h.isEmpty()){(u=l=h.pull()).forEach(function(e){if(e.actionType===U.NONE){a.assert(e.canShift());var n=e.getShift(),r=new K(t);r.index=i++,o.append(r),u.forEach(function(t){if(t.canShift()){t.getShift()===n&&(t.actionType=U.SHIFT,t.shift=r,r.add(t.rule,t.marker+1,!0,t.lah,!1))}})}}),u.complete=!0,c.append(u)}for(;!o.isEmpty();){var u;(u=o.pull()).closure(),u.forEach(function(t){t.canShift()||(t.actionType=U.REDUCE)});var p=null;s(u,function(t){return!!t.canMergeTo(u)&&(t.mergeTo(u)&&t.complete&&(p=t),null!==l&&l.forEach(function(e){e.actionType===U.SHIFT&&e.shift===u&&(e.shift=t)}),u=null,!0)}),null!==p?(c.remove(p),h.append(p),p.complete=!1):null!==u&&(h.append(u),r(u))}n++}var f=0;return c.forEach(function(t){t.stateIndex=f++}),{result:c,iterations:n}}function J(t){var e=[];return{add:function(n){var r;for(r=0;r<e.length&&!((0===r||t(n,e[r-1])>=0)&&t(n,e[r])<=0);r++);!function(t,n){e.push(null);for(var r=e.length-1;r>t;r--)e[r]=e[r-1];e[t]=n}(r,n)},done:function(){return e}}}var Z=function(){return function(t,e){this.emptyCount=t,this.row=e,this.dp=0}}();function tt(t){function e(e,n){return(n-=a[e].dp)<0||n>=t.columns||t.isEmpty(a[e].row,n)}function n(n,r){for(var s=0;s<t.columns;s++)if(!e(n,s))for(var i=0;i<n;i++)if(!e(i,s+r))return!1;return!0}function r(e){for(var r=0;-r<t.columns&&t.isEmpty(a[e].row,-r);)r--;for(;!n(e,r);)r++;return r}for(var s=J(function(t,e){return t.emptyCount<e.emptyCount?-1:t.emptyCount>e.emptyCount?1:0}),i=0;i<t.rows;i++)s.add(new Z(t.emptyCount(i),i));for(var a=s.done(),o=0,h=0,c=new Array(t.rows),l=0;-l<t.columns&&t.isEmpty(a[0].row,-l);)l--;c[a[0].row]=a[0].dp=l;for(i=1;i<a.length;i++){var u=a[i].row,p=r(i);c[u]=a[i].dp=p,p>o&&(o=p),p<h&&(h=p)}return{dps:c,len:o+t.columns}}function et(t,e){for(var n=new Array(t),r=0;r<t;r++)n[r]=e(r);return n}var nt=function(){function t(t){this.g=t.g,this.defred=t.defred,this.stateCount=t.stateCount;var e=tt(function(t){for(var e=[],n=0;n<t.stateCount;n++){e.push(0);for(var r=0;r<t.g.tokens.length;r++)null===t.lookupShift(n,r)&&e[n]++}return{rows:t.stateCount,columns:t.g.tokens.length,isEmpty:function(e,n){return null===t.lookupShift(e,n)},emptyCount:function(t){return e[t]}}}(t)),n=tt(function(t){for(var e=[],n=0;n<t.stateCount;n++){e.push(0);for(var r=0;r<t.g.nts.length;r++)null===t.lookupShift(n,r)&&e[n]++}return{rows:t.stateCount,columns:t.g.nts.length,isEmpty:function(e,n){return null===t.lookupGoto(e,n)},emptyCount:function(t){return e[t]}}}(t));this.disact=e.dps,this.disgoto=n.dps,this.pact=et(e.len,function(){return null}),this.checkact=et(e.len,function(){return 0});var r=this;t.forEachShift(function(t,e,n){a.assert(null===r.pact[r.disact[e]+n]),r.pact[r.disact[e]+n]=t,r.checkact[r.disact[e]+n]=e}),this.pgoto=et(n.len,function(){return null}),this.checkgoto=et(n.len,function(){return 0}),t.forEachGoto(function(t,e,n){a.assert(null===r.pgoto[r.disgoto[e]+n]),r.pgoto[r.disgoto[e]+n]=t,r.checkgoto[r.disgoto[e]+n]=e})}return t.prototype.lookupShift=function(t,e){var n=this.disact[t]+e;return n>=0&&n<this.pact.length&&this.checkact[n]===t?this.pact[this.disact[t]+e]:null},t.prototype.lookupGoto=function(t,e){var n=this.disgoto[t]+e;return n>=0&&n<this.pgoto.length&&this.checkgoto[n]===t?this.pgoto[this.disgoto[t]+e]:null},t}(),rt=function(){function t(t,e,n){this.g=t,this.lhs=e,this.line=n,this.pr=-1,this.rhs=[],this.action=null,this.index=0,this.vars={},this.usedVars={}}return t.prototype.calcPr=function(){if(-1===this.pr)for(var t=this.rhs.length-1;t>=0;t--){var e=this.rhs[t];e>=0&&this.g.tokens[e].assoc!==G.UNDEFINED&&(this.pr=this.g.tokens[e].pr)}},t.prototype.getVarSp=function(t,e){if(1!==this.lhs.parents.length)return this.lhs.parents.length>1?e("LHS of the rule is referenced by more than one rule"):e("this rule is unreachable"),null;for(var n=this.rhs.length,r=this.lhs.parents[0].pos,s=this.lhs.parents[0].rule;;){var i=s.vars[t];if(void 0!==i&&i.val<r)return n+=r-i.val;if(1!==s.lhs.parents.length)return s.lhs.parents.length>1?e('"'+s.lhs.sym+'" is referenced by more than one rule or unreachable'):e("variable is undefined"),null;n+=r,r=s.lhs.parents[0].pos,s=s.lhs.parents[0].rule}},t.prototype.toString=function(t){for(var e=this.index+": "+this.lhs.sym+" =>",n=0;n<this.rhs.length;n++){var r=this.rhs[n];t===n&&(e+=" ."),e+=r>=0?" "+$(this.g.tokens[r]):" "+this.g.nts[-r-1].sym}return t===this.rhs.length&&(e+=" ."),e},t}(),st=function(){function t(){this.tokens=[],this.tokenCount=0,this.nts=[],this.rules=[]}return t.prototype.isToken=function(t){return t>=0},t.prototype.forEachRule=function(t){for(var e=0;e<this.nts.length;e++)for(var n=this.nts[e].rules,r=0;r<n.length;r++)t(e,n[r])},t.prototype.forEachRuleOfNt=function(t,e){for(var n=this.nts[t].rules,r=0;r<n.length&&!e(n[r]);r++);},t.prototype.genFirstSets=function(){var t=!0,e=new M(this.tokens.length);for(e.addAll(),e.remove(0);t;){t=!1;for(var n=0;n<this.nts.length;n++)for(var r=this.nts[n].rules,s=this.nts[n].firstSet,i=0;i<r.length;i++){for(var a=r[i],o=0;o<a.rhs.length;o++){var h=a.rhs[o];if(this.isToken(h)){t=s.add(h+1)||t;break}if(n!==(h=-h-1)&&(t=s.union(this.nts[h].firstSet,e)||t),!this.nts[h].firstSet.contains(0))break}o===a.rhs.length&&(t=s.add(0)||t)}}},t.prototype.toString=function(t){void 0===t&&(t={});var e=(t=t||{}).endl||e,n=t.escape||!1,r="";if(this.forEachRule(function(t,n){var s=n.toString();r+=s+e}),t.firstSets)for(var s=0;s<this.nts.length;s++){var i=this.nts[s];r+="First("+i.sym+") = { "+i.firstSet.toString(this)+" }"+e}return n&&(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;")),r.replace(/\n/g,e)},t.prototype.findTokenByName=function(t){for(var e=0,n=this.tokens;e<n.length;e++){var r=n[e];if(r.sym===t)return r}return null},t.prototype.findTokensByAlias=function(t){for(var e=[],n=0,r=this.tokens;n<r.length;n++){var s=r[n];s.alias===t&&e.push(s)}return e},t}(),it=function(){return function(){this.grammar=null,this.lexDFA=[],this.opt={},this.header="",this.extraArgs=""}}(),at=function(){function t(t){this.getRes=t,this._blocked={}}return t.prototype.wait=function(t,e){var n=this.getRes(t);void 0===n?(this._blocked[t]||(this._blocked[t]=[]),this._blocked[t].push(e)):e(!0,n)},t.prototype.signal=function(t,e){var n=this._blocked[t];if(void 0!==n){for(var r=0,s=n;r<s.length;r++){(0,s[r])(!0,e)}delete this._blocked[t]}},t.prototype.fail=function(){for(var t in this._blocked)for(var e=0,n=this._blocked[t];e<n.length;e++){(0,n[e])(!1,null)}},t}(),ot=function(){return function(t){this.label=t,this.opcodes=[]}}(),ht=function(){function t(t){this.ctx=t,this._head=new T,this._currentState=null,this._unionStack=[],this._simpleStack=[],this._currentArc=null,this._isInverse=!1,this.possibleAlias=null,this._first=!1,this._scount=0,this._regexpVars={},this._states=[new ot("")],this._stateMap={DEFAULT:0},this._selectedStates=[],this._selectedVar=null,this._ar=[];var e=this;this.requiringState=new at(function(t){return e._stateMap[t]})}return t.prototype._emit=function(t){if(null!==this._selectedVar)this._selectedVar.opcodes.push(t);else for(var e=0,n=this._selectedStates;e<n.length;e++){n[e].opcodes.push(t)}},t.prototype._exec=function(t){for(this._head=this._currentState=new T,this._head.isStart=!0,this._unionStack.length=0,this._simpleStack.length=0,this._currentArc=null,this._isInverse=!1,this._ar.length=0,this._ar.push({pc:0,cmds:t});this._ar.length>0;){var e=this._ar[this._ar.length-1];e.cmds.opcodes[e.pc++](this),(e=this._ar[this._ar.length-1]).pc>=e.cmds.opcodes.length&&this._ar.pop()}this._head.removeEpsilons();var n=this._head.toDFA();return new L(n.states)},t.prototype.prepareVar=function(t,e){var n=this._regexpVars[t];void 0!==n&&this.ctx.err(new N('variable "'+t+'" was already defined at line '+n.line,e)),n=this._regexpVars[t]={line:e,cmds:new ot(t)},this._selectedVar=n.cmds},t.prototype.endVar=function(){this._selectedVar=null},t.prototype.prepareLex=function(){this._selectedStates.length=0},t.prototype.selectState=function(t){var e=this._stateMap[t];void 0===e&&(e=this._stateMap[t]=this._states.length,this._states.push(new ot("")),this.requiringState.signal(t,e)),this._selectedStates.push(this._states[this._stateMap[t]])},t.prototype.newState=function(){this._first=!0,this.possibleAlias=null,this._emit(function(t){t._currentState=new T,t._head.epsilonTo(t._currentState)})},t.prototype.end=function(t,e){void 0===e&&(e="(untitled)");for(var n=0,r=this._selectedStates;n<r.length;n++){r[n].label="<"+e+">"}this._emit(function(e){var n=new w;n.id=n.priority=e._scount++,n.data=t,e._currentState.endAction=n})},t.prototype.enterUnion=function(){this._emit(function(t){t._unionStack.push({head:t._currentState,tail:new T})})},t.prototype.endUnionItem=function(){this._emit(function(t){var e=t._unionStack[t._unionStack.length-1];t._currentState.epsilonTo(e.tail),t._currentState=e.head})},t.prototype.leaveUnion=function(){this._emit(function(t){t._currentState=t._unionStack.pop().tail})},t.prototype.enterSimple=function(){this._emit(function(t){t._simpleStack.push(t._currentState)})},t.prototype.simplePostfix=function(t){""===t||(this.possibleAlias=null,this._first=!1),this._emit(function(e){var n=e._simpleStack.pop();"?"===t?n.epsilonTo(e._currentState):"+"===t?e._currentState.epsilonTo(n):"*"===t&&(e._currentState.epsilonTo(n),e._currentState=n)})},t.prototype.addString=function(t){this._first?(this.possibleAlias=t,this._first=!1):this.possibleAlias=null,this._emit(function(e){for(var n=0;n<t.length;n++){var r=new T;e._currentState.to(r).chars.add(t.charCodeAt(n)),e._currentState=r}})},t.prototype.addVar=function(t,e){this._first=!1,this.possibleAlias=null,this._emit(function(n){var r=n._regexpVars[t];void 0===r&&n.ctx.err(new N('use of undefined variable "'+t+'"',e));for(var s=r.cmds,i=0;i<n._ar.length;i++){if(n._ar[i].cmds===s){var a="circular dependence in lexical variable detected: "+s.label;for(i++;i<n._ar.length;i++)a+=" -> "+n._ar[i].cmds.label;return a+=" -> "+s.label,void n.ctx.err(new N(a,e))}}n._ar.push({pc:0,cmds:s})})},t.prototype.beginSet=function(t){this._first=!1,this.possibleAlias=null,this._emit(function(e){e._isInverse=t;var n=new T;e._currentArc=e._currentState.to(n),e._currentState=n,t&&e._currentArc.chars.addAll()})},t.prototype.addSetItem=function(t,e,n,r){1===t.length?1===e.length?(t.charCodeAt(0)>e.charCodeAt(0)&&this.ctx.err(new N("left hand side must be larger than right hand side in wild card character (got '"+t+"' > '"+e+"')",n)),this._emit(function(n){n._isInverse?n._currentArc.chars.remove(t.charCodeAt(0),e.charCodeAt(0)):n._currentArc.chars.add(t.charCodeAt(0),e.charCodeAt(0))})):this.ctx.err(new N('character expected in union, got "'+e+'"',r)):this.ctx.err(new N('character expected in union, got "'+t+'"',n))},t.prototype.endSet=function(){this._emit(function(t){t._currentArc=null})},t.prototype.build=function(){for(var t=[],e=0,n=this._states;e<n.length;e++){var r=n[e];t.push(this._exec(r))}return this.requiringState.fail(),t},t}();function ct(t){}function lt(t,e){return{toCode:function(n){n.addBlock(t,e)},token:-1}}var ut;(pt=ut||(ut={}))[pt.TOKEN=0]="TOKEN",pt[pt.STRING=1]="STRING",pt[pt.NAME=2]="NAME";var pt,ft=function(){function t(t){this._ctx=null,this._f=new it,this._g=new st,this._tokenNameTable={},this._tokenAliasTable={},this._ruleStack=[],this._sematicVar=null,this._ntTable={},this._requiringNt=null,this._genIndex=0,this._first=!0,this._pr=1,this._onCommit=[],this._onDone=[],this._pseudoTokens={};var e=this;this._f.grammar=this._g,this._ctx=t,this.lexBuilder=new ht(t),this._requiringNt=new at(function(t){return e._ntTable[t]}),this.defToken("EOF",null,0)}return t.prototype._top=function(){return this._ruleStack[this._ruleStack.length-1]},t.prototype._splitAction=function(t){var e=this._sematicVar;this._sematicVar=null;var n=this._top(),r="@"+this._genIndex++;this.prepareRule(r,t);var s=this._top();this.addAction(n.action),this.commitRule(),n.action=null,this.addRuleItem(r,ut.NAME,t),this._sematicVar=e;for(var i in n.vars){var a=n.vars[i];s.usedVars[i]={val:a.val,line:a.line}}for(var i in n.usedVars){a=n.usedVars[i];s.usedVars[i]={val:a.val,line:a.line}}},t.prototype.err=function(t,e){this._ctx.err(new N(t,e))},t.prototype.defToken=function(t,e,n){var r=this._tokenNameTable[t];return void 0!==r?r:(r={index:this._g.tokens.length,sym:t,alias:e,line:n,pr:0,assoc:G.UNDEFINED,used:!1},null!==e&&(this._tokenAliasTable[e]||(this._tokenAliasTable[e]=[]),this._tokenAliasTable[e].push(r)),this._tokenNameTable[t]=r,this._g.tokens.push(r),r)},t.prototype.getTokenByAlias=function(t,e){var n=this._tokenAliasTable[t];if(void 0===n)return this.err('cannot identify "'+t+'" as a token',e),null;if(n.length>1){for(var r="",s=0;s<n.length;s++)s>0&&(r+=","),r+="<"+n[s].sym+">";return this.err("cannot identify "+t+" as a token, since it could be "+r,e),null}return n[0]},t.prototype.getTokenByName=function(t,e){var n=this._tokenNameTable[t];return void 0===n?(this.err("cannot identify <"+t+"> as a token",e),null):n},t.prototype.defineTokenPrec=function(t,e,n,r){if(n===ut.TOKEN){null!==(s=this.getTokenByName(t,r))&&(s.assoc=e,s.pr=this._pr)}else if(n===ut.STRING){var s;null!==(s=this.getTokenByAlias(t,r))&&(s.assoc=e,s.pr=this._pr)}else if(n===ut.NAME)this._pseudoTokens[t]=this._pseudoTokens[t]||{assoc:e,pr:this._pr,line:r}},t.prototype.setOpt=function(t,e){return this._f.opt[t]=e,this},t.prototype.setHeader=function(t){this._f.header=t},t.prototype.setExtraArg=function(t){this._f.extraArgs=t},t.prototype.setType=function(t){this._f.sematicType=t},t.prototype.incPr=function(){return this._pr++,this},t.prototype.prepareRule=function(t,e){this._first&&(this._first=!1,this.prepareRule("(accept)",e),this.addRuleItem(t,ut.NAME,e),this.addRuleItem("EOF",ut.TOKEN,e),this.commitRule());var n=this._ntTable[t];void 0===n&&(n=this._ntTable[t]={index:this._g.nts.length,sym:t,firstSet:null,used:!1,rules:[],parents:[]},this._g.nts.push(n),this._requiringNt.signal(t,n));var r=new rt(this._g,n,e);return this._ruleStack.push(r),this},t.prototype.addRuleUseVar=function(t,e){var n=this._top();void 0!==n.usedVars[t]?this.err('re-use of sematic variable "'+t+'"',e):n.usedVars[t]={line:e,val:0}},t.prototype.addRuleSematicVar=function(t,e){var n=this._top();void 0!==n.usedVars[t]?this.err('variable "'+t+'" conflicts with imported variable defined at line '+n.usedVars[t].line,e):void 0!==n.vars[t]?this.err('sematic variable "'+t+'" is already defined at line '+n.vars[t].line,e):this._sematicVar={line:e,val:t}},t.prototype.addRuleItem=function(t,e,n){var r=this._top();if(null!==r.action&&this._splitAction(n),null!==this._sematicVar&&(r.vars[this._sematicVar.val]={val:r.rhs.length,line:this._sematicVar.line},this._sematicVar=null),e===ut.NAME){var s=this,i=r.rhs.length;r.rhs.push(0),this._requiringNt.wait(t,function(e,a){e?(r.rhs[i]=-a.index-1,a.parents.push({rule:r,pos:i}),a.used=!0):s.err("use of undefined non terminal "+t,n)})}else if(e===ut.TOKEN){var a=this._tokenNameTable[t];if(void 0===a)return void this.err("cannot recognize <"+t+"> as a token",n);r.rhs.push(a.index),a.used=!0}else if(e===ut.STRING){var o=this.getTokenByAlias(t,n);null!==o&&(r.rhs.push(o.index),o.used=!0)}},t.prototype.addAction=function(t){var e=this._top();return null!==e.action&&this._splitAction(e.line),e.action=t,null!==this._sematicVar&&(e.vars[this._sematicVar.val]={val:e.rhs.length,line:this._sematicVar.line},this._sematicVar=null,this._splitAction(e.line)),this},t.prototype.defineRulePr=function(t,e,n){if(e===ut.STRING||e===ut.TOKEN){var r=e===ut.STRING?this.getTokenByAlias(t,n):this.getTokenByName(t,n);if(null!==r){if(r.assoc===G.UNDEFINED)return void this.err('precedence of token "'+t+'" has not been defined',n);this._top().pr=r.pr}}else{var s=this._pseudoTokens[t];s||this.err('pseudo token "'+t+'" is not defined',n),this._top().pr=s.pr}},t.prototype.commitRule=function(){var t=this._ruleStack.pop();t.index=this._g.rules.length,t.lhs.rules.push(t),this._g.rules.push(t);for(var e=0,n=this._onCommit;e<n.length;e++){(0,n[e])()}return this._onCommit.length=0,this},t.prototype.addPushStateAction=function(t,e,n){var r=this;this.lexBuilder.requiringState.wait(e,function(s,i){s?t.push((a=i,{toCode:function(t){t.pushLexState(a)},token:-1})):r._ctx.err(new N('state "'+e+'" is undefined',n));var a})},t.prototype.build=function(){this._g.tokenCount=this._g.tokens.length,this._g.tokens[0].used=!0,this._g.nts[0].used=!0;for(var t=this,e=0,n=this._g.nts;e<n.length;e++){var r=n[e];r.firstSet=new M(this._g.tokenCount);for(var s=0,i=r.rules;s<i.length;s++){var a=i[s];a.calcPr();var o=function(e){var n=a.usedVars[e];n.val=a.getVarSp(e,function(r){t.err('cannot find variable "'+e+'": '+r,n.line)})};for(var h in a.usedVars)o(h)}}this._f.lexDFA=this.lexBuilder.build();for(var c=0,l=this._onDone;c<l.length;c++){(0,l[c])()}return this._requiringNt.fail(),this._f},t}();function dt(t){return{val:t.val,ext:null,startLine:t.startLine,startColumn:t.startColumn,endLine:t.endLine,endColumn:t.endColumn}}function _t(t){return{val:null,ext:null,startLine:t.startLine,startColumn:t.startColumn,endLine:t.endLine,endColumn:t.endColumn}}function vt(t){return{val:t,ext:null,startLine:0,startColumn:0,endLine:0,endColumn:0}}function gt(t){return t.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\\\/g,"\\")}var mt=[function(t,e){switch(e.state){case 0:e.hasArc=!0,e.isEnd=!1,e.state=t>=9&&t<=10||13===t||32===t?1:34===t?2:36===t||t>=65&&t<=90||95===t||t>=97&&t<=122?3:37===t?4:39===t?5:40===t?6:41===t?7:42===t?8:43===t?9:44===t?10:45===t?11:47===t?12:58===t?13:59===t?14:60===t?15:61===t?16:62===t?17:63===t?18:91===t?19:93===t?20:94===t?21:123===t?22:124===t?23:125===t?24:-1;break;case 1:e.hasArc=!0,e.isEnd=!0,e.state=t>=9&&t<=10||13===t||32===t?1:-1;break;case 2:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=33||t>=35&&t<=91||t>=93?25:34===t?26:92===t?27:-1;break;case 3:e.hasArc=!0,e.isEnd=!0,e.state=36===t||t>=65&&t<=90||95===t||t>=97&&t<=122?28:t>=48&&t<=57?29:-1;break;case 4:e.hasArc=!0,e.isEnd=!1,e.state=37===t?30:101===t?31:104===t?32:108===t?33:110===t?34:111===t?35:112===t?36:114===t?37:116===t?38:117===t?39:-1;break;case 5:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=38||t>=40&&t<=91||t>=93?40:39===t?41:92===t?42:-1;break;case 6:case 7:case 8:case 9:case 10:case 11:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 12:e.hasArc=!0,e.isEnd=!1,e.state=42===t?43:47===t?44:-1;break;case 13:case 14:case 15:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 16:e.hasArc=!0,e.isEnd=!0,e.state=62===t?45:-1;break;case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 25:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=33||t>=35&&t<=91||t>=93?25:34===t?26:92===t?27:-1;break;case 26:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 27:e.hasArc=!0,e.isEnd=!1,e.state=34===t||39===t||92===t||98===t||102===t||110===t||114===t||116===t?46:117===t||120===t?47:-1;break;case 28:case 29:e.hasArc=!0,e.isEnd=!0,e.state=36===t||t>=65&&t<=90||95===t||t>=97&&t<=122?28:t>=48&&t<=57?29:-1;break;case 30:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 31:e.hasArc=!0,e.isEnd=!1,e.state=109===t?48:120===t?49:-1;break;case 32:e.hasArc=!0,e.isEnd=!1,e.state=101===t?50:-1;break;case 33:e.hasArc=!0,e.isEnd=!1,e.state=101===t?51:-1;break;case 34:e.hasArc=!0,e.isEnd=!1,e.state=111===t?52:-1;break;case 35:e.hasArc=!0,e.isEnd=!1,e.state=112===t?53:-1;break;case 36:e.hasArc=!0,e.isEnd=!1,e.state=114===t?54:-1;break;case 37:e.hasArc=!0,e.isEnd=!1,e.state=105===t?55:-1;break;case 38:e.hasArc=!0,e.isEnd=!1,e.state=121===t?56:-1;break;case 39:e.hasArc=!0,e.isEnd=!1,e.state=115===t?57:-1;break;case 40:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=38||t>=40&&t<=91||t>=93?40:39===t?41:92===t?42:-1;break;case 41:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 42:e.hasArc=!0,e.isEnd=!1,e.state=34===t||39===t||92===t||98===t||102===t||110===t||114===t||116===t?58:117===t||120===t?59:-1;break;case 43:e.hasArc=!0,e.isEnd=!1,e.state=t<=41||t>=43&&t<=46||t>=48?60:42===t?61:47===t?62:-1;break;case 44:e.hasArc=!0,e.isEnd=!0,e.state=t<=9||t>=11?63:-1;break;case 45:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 46:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=33||t>=35&&t<=91||t>=93?25:34===t?26:92===t?27:-1;break;case 47:e.hasArc=!0,e.isEnd=!1,e.state=t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102?64:-1;break;case 48:e.hasArc=!0,e.isEnd=!1,e.state=112===t?65:-1;break;case 49:e.hasArc=!0,e.isEnd=!1,e.state=116===t?66:-1;break;case 50:e.hasArc=!0,e.isEnd=!1,e.state=97===t?67:-1;break;case 51:e.hasArc=!0,e.isEnd=!1,e.state=102===t?68:120===t?69:-1;break;case 52:e.hasArc=!0,e.isEnd=!1,e.state=110===t?70:-1;break;case 53:e.hasArc=!0,e.isEnd=!1,e.state=116===t?71:-1;break;case 54:e.hasArc=!0,e.isEnd=!1,e.state=101===t?72:-1;break;case 55:e.hasArc=!0,e.isEnd=!1,e.state=103===t?73:-1;break;case 56:e.hasArc=!0,e.isEnd=!1,e.state=112===t?74:-1;break;case 57:e.hasArc=!0,e.isEnd=!1,e.state=101===t?75:-1;break;case 58:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=38||t>=40&&t<=91||t>=93?40:39===t?41:92===t?42:-1;break;case 59:e.hasArc=!0,e.isEnd=!1,e.state=t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102?76:-1;break;case 60:e.hasArc=!0,e.isEnd=!1,e.state=t<=41||t>=43&&t<=46||t>=48?60:42===t?61:47===t?77:-1;break;case 61:e.hasArc=!0,e.isEnd=!1,e.state=t<=46||t>=48?78:47===t?79:-1;break;case 62:e.hasArc=!0,e.isEnd=!1,e.state=47===t?80:-1;break;case 63:e.hasArc=!0,e.isEnd=!0,e.state=t<=9||t>=11?63:-1;break;case 64:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=33||t>=35&&t<=47||t>=58&&t<=64||t>=71&&t<=91||t>=93&&t<=96||t>=103?25:34===t?26:t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102?81:92===t?27:-1;break;case 65:e.hasArc=!0,e.isEnd=!1,e.state=116===t?82:-1;break;case 66:e.hasArc=!0,e.isEnd=!1,e.state=114===t?83:-1;break;case 67:e.hasArc=!0,e.isEnd=!1,e.state=100===t?84:-1;break;case 68:e.hasArc=!0,e.isEnd=!1,e.state=116===t?85:-1;break;case 69:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 70:e.hasArc=!0,e.isEnd=!1,e.state=97===t?86:-1;break;case 71:e.hasArc=!0,e.isEnd=!1,e.state=105===t?87:-1;break;case 72:e.hasArc=!0,e.isEnd=!1,e.state=99===t?88:-1;break;case 73:e.hasArc=!0,e.isEnd=!1,e.state=104===t?89:-1;break;case 74:e.hasArc=!0,e.isEnd=!1,e.state=101===t?90:-1;break;case 75:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 76:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=38||t>=40&&t<=47||t>=58&&t<=64||t>=71&&t<=91||t>=93&&t<=96||t>=103?40:39===t?41:t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102?91:92===t?42:-1;break;case 77:e.hasArc=!0,e.isEnd=!1,e.state=t<=41||t>=43&&t<=46||t>=48?60:42===t?61:47===t?77:-1;break;case 78:e.hasArc=!0,e.isEnd=!1,e.state=t<=41||t>=43&&t<=46||t>=48?60:42===t?61:47===t?62:-1;break;case 79:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 80:e.hasArc=!0,e.isEnd=!1,e.state=t<=41||t>=43&&t<=46||t>=48?60:42===t?61:47===t?62:-1;break;case 81:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=33||t>=35&&t<=47||t>=58&&t<=64||t>=71&&t<=91||t>=93&&t<=96||t>=103?25:34===t?26:t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102?81:92===t?27:-1;break;case 82:e.hasArc=!0,e.isEnd=!1,e.state=121===t?92:-1;break;case 83:e.hasArc=!0,e.isEnd=!1,e.state=97===t?93:-1;break;case 84:e.hasArc=!0,e.isEnd=!1,e.state=101===t?94:-1;break;case 85:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 86:e.hasArc=!0,e.isEnd=!1,e.state=115===t?95:-1;break;case 87:e.hasArc=!0,e.isEnd=!1,e.state=111===t?96:-1;break;case 88:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 89:e.hasArc=!0,e.isEnd=!1,e.state=116===t?97:-1;break;case 90:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 91:e.hasArc=!0,e.isEnd=!1,e.state=t<=9||t>=11&&t<=38||t>=40&&t<=47||t>=58&&t<=64||t>=71&&t<=91||t>=93&&t<=96||t>=103?40:39===t?41:t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102?91:92===t?42:-1;break;case 92:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 93:e.hasArc=!0,e.isEnd=!1,e.state=95===t?98:-1;break;case 94:e.hasArc=!0,e.isEnd=!1,e.state=114===t?99:-1;break;case 95:e.hasArc=!0,e.isEnd=!1,e.state=115===t?100:-1;break;case 96:e.hasArc=!0,e.isEnd=!1,e.state=110===t?101:-1;break;case 97:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 98:e.hasArc=!0,e.isEnd=!1,e.state=97===t?102:-1;break;case 99:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 100:e.hasArc=!0,e.isEnd=!1,e.state=111===t?103:-1;break;case 101:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;case 102:e.hasArc=!0,e.isEnd=!1,e.state=114===t?104:-1;break;case 103:e.hasArc=!0,e.isEnd=!1,e.state=99===t?105:-1;break;case 104:e.hasArc=!0,e.isEnd=!1,e.state=103===t?106:-1;break;case 105:case 106:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;default:e.state=-1,e.hasArc=!1}},function(t,e){switch(e.state){case 0:e.hasArc=!0,e.isEnd=!0,e.state=t<=122||124===t||t>=126?1:123===t?2:125===t?3:-1;break;case 1:e.hasArc=!0,e.isEnd=!0,e.state=t<=122||124===t||t>=126?1:-1;break;case 2:case 3:e.hasArc=!1,e.isEnd=!0,e.state=-1;break;default:e.state=-1,e.hasArc=!1}}],kt=[-1,-1,-1,1,-1,-1,18,19,24,25,33,26,-1,27,29,17,20,16,23,21,22,32,3,31,4,-1,2,-1,1,1,30,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,-1,-1,-1,28,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,-1,-1,-1,-1,-1,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,-1,-1,15,-1,14,-1,13,-1,-1,-1,-1,8,-1,11,-1,5,-1,-1,-1,9,12],bt=[34,34,3,4],St=[9,7,13,14,15,143,10,11,77,12,-106,-45,162,110,-45,151,152,150,107,108,142,140,-82,110,141,5,-45,-46,107,108,-46,89,-100,86,89,-100,-82,147,-82,24,89,52,-46,24,89,-107,88,93,121,88,54,60,55,-34,58,88,48,43,19,88,42,94,37,38,161,133,159,158,157,133,155,120,145,49,144,52,137,104,125,124,123,122,118,-100,114,113,112,29,104,101,-89,99,98,97,96,95,90,83,81,80,75,71,69,68,64,63,62,57,50,41,39,33,28,25,19,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],yt=[-35,115,-5,-35,113,-35,-35,42,110,-35,-35,111,-35,-35,-35,57,-35,-35,-35,94,38,-35,-35,-35,-35,-35,-35,-35,-35,-35,35,107,108,-35,56,-35,-35,-35,-35,40,-35,-35,88,21,-35,97,50,-35,105,103,-35,-35,101,-35,-35,90,84,-35,-35,-35,84,-35,-35,-35,-35,85,7,-35,98,78,96,41,-35,32,32,-35,76,29,28,-35,78,78,66,88,-35,-35,-35,90,-35,89,-35,-35,-35,88,-35,61,-35,-35,70,84,-35,68,-35,80,66,-35,80,-35,-35,78,76,-35,-35,-35,-35,57,-35,50,-35,-35,3,-35,-35,-35,-7,-35,45,11,-35,3,41,-35,46,-35,7,15,-35,-35,-8,-35,39,69,-35,67,66,63,-35,-5,-35,-35,-35,-35,47,63,48,-35,-35,-35,-35,-10,-35,-35],xt=[2,2,2,2,2,129,2,2,66,2,134,147,159,124,147,138,138,138,124,124,129,129,66,120,129,2,147,127,120,120,127,77,77,74,74,73,66,135,66,20,20,134,127,7,7,71,77,78,135,74,43,46,43,73,46,20,39,34,15,7,34,78,30,30,154,153,152,145,144,143,141,140,132,39,130,71,126,117,115,110,109,106,104,103,101,99,98,15,95,93,89,87,83,82,81,80,76,70,69,68,65,60,56,55,52,49,48,45,42,32,31,19,11,8,4,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],At=[3,-1,-1,0,-1,2,4,-1,-1,99,99,-1,11,12,13,-1,67,68,69,21,6,15,16,17,19,8,9,10,1,66,-1,-1,-1,14,-1,75,71,72,25,-1,22,7,-1,-1,74,78,30,20,-1,-1,102,104,-1,70,75,84,-1,5,24,26,-1,23,18,103,73,94,86,82,-1,-1,42,105,76,95,-1,83,87,33,-1,80,-1,-1,-1,-1,96,97,98,-1,93,85,90,91,77,-1,42,32,42,107,-1,-1,79,-1,28,33,-1,37,-1,39,40,-1,-1,92,89,27,31,-1,35,32,48,58,99,38,41,103,99,29,43,48,47,-1,60,63,64,36,100,-1,48,46,53,42,59,-1,57,-1,-1,-1,34,48,49,50,51,52,-1,61,-1,62,65,101,54,-1,56,55],Et=[5,138,7,84,115,91,115,77,75,31,20,21,137,129,148,137,129,135,105,86,55,133,72,73,35,33,19,159,130,131,155,153,145,78,50,52,90,116,110,116,110,114,115,50,52,83,81,118,134,108,110,22,108,110,65,66,58,125,60,29,17,102,99,69,46,22,64,45,39,30,26,110,15,16,17,116,110,1,2,152,118,147,128,129,126,127,128,129,104,118,101,118,71,43,44,45,34,25,110,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],wt=[76,-57,-3,-57,40,-57,22,4,-57,47,20,-57,-57,-57,-57,26,-57,-57,34,0,18,-57,-57,-57,88,-57,-57,-57,-57,-57,-12,-57,58,-57,-57,56,-57,-57,53,-57,-57,-57,-57,-57,-57,-20,44,-57,-57,-57,-57,-57,-57,-57,28,12,-57,-57,-57,50,-57,-57,-57,39,-57,-26,-37,-57,-8,-57,26,-11,-57,-13,-28,-57,-57,-11,-57,-57,-57,-57,-57,-57,-57,-57,-57,-57,-57,16,-57,-57,-57,-57,70,46,68,-57,-57,-57,-57,-57,-57,25,-57,-57,-57,-57,-57,-57,-57,-57,-57,-57,-57,-57,-57,42,62,-57,2,-57,-57,-5,-1,-57,-57,-9,-57,-26,-57,-57,-57,-57,-20,-57,58,-57,-12,59,3,-57,-57,-1,-57,-57,-57,-12,-57,-57,-57,-57,-57,-2,-57,-57,-57,-57,-57,-57,-57,-57],Tt=[2,4,2,0,0,6,2,4,2,2,2,1,1,1,2,1,1,1,4,0,3,0,1,3,2,0,0,6,5,7,0,2,0,0,4,1,3,1,2,1,1,2,0,2,3,1,2,1,0,3,1,1,1,0,3,4,3,1,1,0,1,0,3,1,1,3,2,1,1,0,5,1,1,3,1,0,4,4,0,3,1,1,1,2,0,2,0,1,0,4,2,2,3,1,0,1,2,2,2,0,0,5,2,0,1,0,0,5],Ct=[0,1,2,2,4,3,3,3,3,3,3,5,5,5,6,6,7,7,8,8,9,9,10,10,11,11,13,12,12,12,14,15,15,17,16,16,18,18,19,19,19,19,21,20,22,22,23,23,25,24,26,26,26,26,27,27,27,27,28,28,29,29,30,30,31,31,32,32,33,35,34,36,36,37,37,39,38,40,40,41,41,42,42,43,43,44,44,45,46,45,45,45,47,47,48,48,48,49,49,51,52,50,53,53,54,55,56,54],Lt=["EOF","NAME","STRING","OPEN_BLOCK","CLOSE_BLOCK","OPT_DIR","LEX_DIR","LEFT_DIR","RIGHT_DIR","NONASSOC_DIR","USE_DIR","HEADER_DIR","EXTRA_ARG_DIR","EMPTY","TYPE_DIR","PREC_DIR","GT","LT","BRA","KET","EQU","CBRA","CKET","QUESTION","STAR","PLUS","DASH","COLON","ARROW","EOL","SEPERATOR","OR","WEDGE","COMMA","ANY_CODE"],Rt=[null,null,null,"{","}","%option","%lex","%left","%right","%nonassoc","%use","%header","%extra_arg","%empty","%type","%prec",">","<","(",")","=","[","]","?","*","+","-",":","=>",";","%%","|","^",",",null];var Nt=function(){function t(t,e,n,r,s,i){this.id=t,this.val=e,this.startLine=n,this.startColumn=r,this.endLine=s,this.endColumn=i}return t.prototype.clone=function(){return new t(this.id,this.val,this.startLine,this.startColumn,this.endLine,this.endColumn)},t.prototype.toString=function(){return(null===Rt[this.id]?"<"+Lt[this.id]+">":'"'+Rt[this.id]+'"')+'("'+this.val+'")'},t}(),It=function(){function t(){this._marker={state:-1,line:0,column:0},this._lrState=[],this._sematicS=[],this._handlers={},this.init()}return t.prototype.init=function(){this._lexState=[0],this._state=0,this._matched="",this._token=new Nt(-1,null,0,0,0,0),this._marker.state=-1,this._backupCount=0,this._line=this._tline=1,this._column=this._tcolumn=1,this._lrState=[0],this._sematicS=[],this._sematicVal=null,this._stop=!1},t.prototype._setImg=function(t){this._matched=t,this._tline=this._line,this._tcolumn=this._column},t.prototype._prepareToken=function(t){this._token.id=t,this._token.val=this._matched,this._token.startLine=this._tline,this._token.startColumn=this._tcolumn,this._token.endLine=this._line,this._token.endColumn=this._column,this._matched="",this._tline=this._line,this._tcolumn=this._column},t.prototype._returnToken=function(){for(this._emit("token",Lt[this._token.id],this._token.val);!this._stop&&!this._acceptToken(this._token););this._token.id=-1},t.prototype._emit=function(t,e,n,r){var s=this._handlers[t];if(s)for(var i=0,a=s;i<a.length;i++){(0,a[i])(e,n,r)}},t.prototype.on=function(t,e){this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e)},t.prototype._doLexAction0=function(t){var e=kt[t];switch(-1!==e&&this._prepareToken(e),t){case 1:this._setImg("");break;case 3:this._sematicVal=dt(this._token);break;case 22:case 24:this._sematicVal=_t(this._token);break;case 26:this._sematicVal=dt(this._token),this._sematicVal.val=gt(this._sematicVal.val.substr(1,this._sematicVal.val.length-2));break;case 28:case 29:this._sematicVal=dt(this._token);break;case 41:this._sematicVal=dt(this._token),this._sematicVal.val=gt(this._sematicVal.val.substr(1,this._sematicVal.val.length-2));break;case 44:case 63:case 79:this._setImg("")}},t.prototype._doLexAction1=function(t){var e=bt[t];switch(-1!==e&&this._prepareToken(e),t){case 0:case 1:this._sematicVal=vt(this._token.val);break;case 2:case 3:this._sematicVal=_t(this._token)}},t.prototype._doLexAction=function(t,e){switch(t){case 0:this._doLexAction0(e);break;case 1:this._doLexAction1(e)}-1!==this._token.id&&this._returnToken()},t.prototype._rollback=function(){var t=this._matched.substr(this._matched.length-this._backupCount,this._backupCount);return this._matched=this._matched.substr(0,this._matched.length-this._backupCount),this._backupCount=0,this._line=this._marker.line,this._column=this._marker.column,this._state=this._marker.state,this._marker.state=-1,t},t.prototype._mark=function(){this._marker.state=this._state,this._marker.line=this._line,this._marker.column=this._column,this._backupCount=0},t.prototype._acceptChar=function(t){function e(t,e){return"\n"===e?(t._line++,t._column=0):t._column++,t._matched+=e,-1!==t._marker.state&&t._backupCount++,!0}var n=this._lexState[this._lexState.length-1],r={state:this._state,hasArc:!1,isEnd:!1};if(mt[n](t.charCodeAt(0),r),r.isEnd)return r.hasArc?-1===r.state?(this._doLexAction(n,this._state),this._marker.state=-1,this._backupCount=0,this._state=0,!1):(this._mark(),this._state=r.state,e(this,t)):(this._doLexAction(n,this._state),this._marker.state=-1,this._backupCount=0,this._state=0,!1);if(-1===r.state){if(-1!==this._marker.state){var s=this._rollback();return this._doLexAction(n,this._state),this._state=0,this.accept(s),!1}return this._emit("lexicalerror",'unexpected character "'+t+'"',this._line,this._column),!0}return this._state=r.state,e(this,t)},t.prototype._acceptEOF=function(){if(0===this._state)return this._prepareToken(0),this._returnToken(),!0;var t=this._lexState[this._lexState.length-1],e={state:this._state,hasArc:!1,isEnd:!1};if(mt[t](-1,e),e.isEnd)return this._doLexAction(t,this._state),this._state=0,this._marker.state=-1,!1;if(-1!==this._marker.state){var n=this._rollback();return this._doLexAction(t,this._state),this._state=0,this.accept(n),!1}return this._emit("lexicalerror","unexpected end of file"),!0},t.prototype.accept=function(t){for(var e=0;e<t.length&&!this._stop;)this._acceptChar(t.charAt(e))&&e++},t.prototype.end=function(){for(;!this._stop&&!this._acceptEOF(););this._stop=!0},t.prototype.halt=function(){this._stop=!0},t.prototype._doReduction=function(t){var e=Ct[t],n=this._sematicS.length,r=this._sematicS[n-Tt[t]]||null;switch(t){case 4:this.gb.lexBuilder.prepareLex();break;case 8:var s=this._sematicS[n-1];this.gb.setHeader(s.val);break;case 9:s=this._sematicS[n-1];this.gb.setExtraArg(s.val);break;case 10:var i=this._sematicS[n-1];this.gb.setType(i.val);break;case 11:this.assoc=G.LEFT;break;case 12:this.assoc=G.RIGHT;break;case 13:this.assoc=G.NON;break;case 16:i=this._sematicS[n-1];this.gb.defineTokenPrec(i.val,this.assoc,i.ext,i.startLine);break;case 17:i=this._sematicS[n-1];this.gb.defineTokenPrec(i.val,this.assoc,ut.NAME,i.startLine);break;case 18:var a=this._sematicS[n-3],o=this._sematicS[n-1];this.gb.setOpt(a.val,o.val);break;case 21:this.gb.lexBuilder.selectState("DEFAULT");break;case 22:case 23:d=this._sematicS[n-1];this.gb.lexBuilder.selectState(d.val);break;case 26:var h=this._sematicS[n-1];this.gb.lexBuilder.prepareVar(h.val,h.startLine);break;case 27:h=this._sematicS[n-6];this.gb.lexBuilder.endVar();break;case 28:this.gb.lexBuilder.end(this.lexacts,"(untitled)");break;case 29:var c=this._sematicS[n-5],l=this.gb.defToken(c.val,this.gb.lexBuilder.possibleAlias,c.startLine);this.lexacts.push({toCode:ct,token:l.index}),this.gb.lexBuilder.end(this.lexacts,c.val);break;case 30:this.gb.lexBuilder.newState();break;case 32:case 33:this.lexacts=[];break;case 35:s=this._sematicS[n-1];this.lexacts=[lt(s.val,s.startLine)];break;case 38:var u=this._sematicS[n-1];this.gb.addPushStateAction(this.lexacts,u.val,u.startLine);break;case 39:this.lexacts.push({toCode:function(t){t.popLexState()},token:-1});break;case 40:s=this._sematicS[n-1];this.lexacts.push(lt(s.val,s.startLine));break;case 41:d=this._sematicS[n-1];this.lexacts.push((S=d.val,{toCode:function(t){t.setImg(S)},token:-1}));break;case 42:this.gb.lexBuilder.enterUnion();break;case 43:this.gb.lexBuilder.leaveUnion();break;case 44:case 45:this.gb.lexBuilder.endUnionItem();break;case 48:this.gb.lexBuilder.enterSimple();break;case 49:var p=this._sematicS[n-1];this.gb.lexBuilder.simplePostfix(p.val);break;case 50:r=vt("+");break;case 51:r=vt("?");break;case 52:r=vt("*");break;case 53:r=vt("");break;case 56:var f=this._sematicS[n-2];this.gb.lexBuilder.addVar(f.val,f.startLine);break;case 57:d=this._sematicS[n-1];this.gb.lexBuilder.addString(d.val);break;case 58:this.gb.lexBuilder.beginSet(!0);break;case 59:this.gb.lexBuilder.beginSet(!1);break;case 64:var d=this._sematicS[n-1];this.gb.lexBuilder.addSetItem(d.val,d.val,d.startLine,d.startLine);break;case 65:var _=this._sematicS[n-3],v=this._sematicS[n-1];this.gb.lexBuilder.addSetItem(_.val,v.val,_.startLine,v.startLine);break;case 69:f=this._sematicS[n-1];this.ruleLhs=f;break;case 75:this.gb.prepareRule(this.ruleLhs.val,this.ruleLhs.startLine);break;case 76:this.gb.commitRule();break;case 79:case 80:u=this._sematicS[n-1];this.gb.addRuleUseVar(u.val,u.startLine);break;case 85:var g=this._sematicS[n-2];this.gb.addRuleSematicVar(g.val,g.startLine);break;case 87:i=this._sematicS[n-1];this.gb.addRuleItem(i.val,ut.NAME,i.startLine);break;case 88:u=this._sematicS[n-2];this.gb.addRuleSematicVar(u.val,u.startLine);break;case 89:u=this._sematicS[n-4],i=this._sematicS[n-1];this.gb.addRuleItem(i.val,ut.NAME,i.startLine);break;case 90:i=this._sematicS[n-1];this.gb.addRuleItem(i.val,i.ext,i.startLine);break;case 91:this.gb.addAction(this.lexacts);break;case 92:(r=i=this._sematicS[n-2]).ext=ut.TOKEN;break;case 93:r.ext=ut.STRING;break;case 96:this.gb.addAction(this.lexacts);break;case 97:i=this._sematicS[n-1];this.gb.defineRulePr(i.val,ut.NAME,i.startLine);break;case 98:i=this._sematicS[n-1];this.gb.defineRulePr(i.val,i.ext,i.startLine);break;case 99:this._lexState.push(1);break;case 100:var m=this._sematicS[n-2],k=this._sematicS[n-1];this._lexState.pop();break;case 101:m=this._sematicS[n-4],k=this._sematicS[n-3];var b=this._sematicS[n-1];(r=vt("")).val=k.val,r.startLine=m.startLine,r.startColumn=m.startColumn,r.endLine=b.endLine,r.endColumn=b.endColumn;break;case 102:s=this._sematicS[n-1];r.val+=s.val;break;case 103:r=vt("");break;case 105:this._lexState.push(1);break;case 106:s=this._sematicS[n-1];this._lexState.pop();break;case 107:s=this._sematicS[n-3];(r=vt("")).val="{"+s.val+"}"}var S;this._lrState.length-=Tt[t];var y=this._lrState[this._lrState.length-1];this._lrState.push(Et[wt[y]+e]),this._sematicS.length-=Tt[t],this._sematicS.push(r)},t.prototype._acceptToken=function(t){var e=this._lrState[this._lrState.length-1],n=yt[e]+t.id,r=0;return 163===(r=n<0||n>=St.length||xt[n]!==e?-At[e]-1:St[n])?(this._syntaxError(t),!0):r>0?0===t.id?(this._stop=!0,this._emit("accept"),!0):(this._lrState.push(r-1),this._sematicS.push(this._sematicVal),this._sematicVal=null,!0):r<0?(this._doReduction(-r-1),!1):(this._syntaxError(t),!0)},t.prototype._syntaxError=function(t){var e="unexpected token "+t.toString()+", expecting one of the following token(s):\n";e+=this._expected(this._lrState[this._lrState.length-1]),this._emit("syntaxerror",e,t)},t.prototype._expected=function(t){var e=yt[t],n="";function r(n){var r=e+n;return!(r<0||r>=St.length||t!==xt[r])||-1!==At[t]}for(var s=0;s<35;s++)r(s)&&(n+="    "+(i=s,null===Rt[i]?"<"+Lt[i]+">":'"'+Rt[i]+'"')+" ...\n");var i;return n},t}();var Vt=function(){function t(){this.errors=[],this.warnings=[],this.terminated=!1}return t.prototype.warn=function(t){this.warnings.push(t)},t.prototype.err=function(t){this.errors.push(t)},t.prototype.printItemSets=function(t){t.writeln(this.itemSets.size+" state(s) in total,finished in "+this.iterationCount+" iteration(s)."),this.itemSets.forEach(function(e){t.writeln(e.toString({showTrailer:!0}))})},t.prototype.printTable=function(t){!function(t,e,n){var r=e.g,s=r.tokenCount,a=r.nts.length;n.forEach(function(n){var o=n.stateIndex,h="",c="",l="";t.writeln("state "+o),n.forEach(function(e){t.writeln(i+e.toString({showTrailer:!1}))}),-1!==e.defred[o]?t.writeln(i+"default action: reduce with rule "+e.defred[o]):t.writeln(i+"no default action");for(var u=0;u<s;u++)null!==(p=e.lookupShift(o,u))&&p!==H.NULL&&(p.actionType===U.SHIFT?h+=""+i+$(r.tokens[u])+" : shift, and goto state "+p.shift.stateIndex+v:c+=""+i+$(r.tokens[u])+" : reduce with rule "+p.rule.index+v);for(u=0;u<a;u++){var p;null!==(p=e.lookupGoto(o,u))&&(l+=""+i+r.nts[u].sym+" : goto state "+p.shift.stateIndex+v)}t.writeln(h+c+l),t.writeln("")})}(t,this.parseTable,this.itemSets)},t.prototype.printDFA=function(t){for(var e=0,n=this.file.lexDFA;e<n.length;e++){n[e].print(t),t.writeln(),t.writeln()}},t.prototype.testParse=function(t){return function(t,e,n){for(var r=[],s=0,i=n;s<i.length;s++){var a=i[s],o=void 0;if(/<[^>]+>/.test(a)){if(null===(o=t.findTokenByName(a.substr(1,a.length-2))))throw new R("cannot recognize "+a+" as a token")}else{var h=t.findTokensByAlias(a);if(0===h.length)throw new R('cannot recognize "'+a+'" as a token');if(h.length>1){for(var c="",l=0,u=h;l<u.length;l++)c+="<"+u[l].sym+"> ";throw new R('cannot recognize "'+a+'" as a token, since it can be '+c)}o=h[0]}r.push(o)}var p=[0],f=[],d=[];function _(){return p[p.length-1]}function v(t){p.push(t);var e=r.shift();f.push($(e))}function g(t){p.length-=t.rhs.length,f.length-=t.rhs.length,f.push(t.lhs.sym);var n=e.lookupGoto(_(),t.lhs.index).shift.stateIndex;p.push(n)}function m(){for(var t="",e=0,n=f;e<n.length;e++)t+=n[e]+" ";t+="| ";for(var s=0,i=r;s<i.length;s++)t+=$(i[s]),t+=" ";return t}for(d.push(m());;){var k=e.lookupShift(_(),r[0]?r[0].index:0);if(null!==k){if(k===H.NULL){d.push("syntax error!");break}if(k.actionType===U.SHIFT){if(0===r.length){d.push("accepted!");break}v(k.shift.stateIndex)}else if(k.actionType===U.REDUCE){if(g(k.rule))break}else console.assert(!1)}else{var b=e.defred[_()];if(-1===b){d.push("syntax error!");break}g(t.rules[b])}d.push(m())}return d}(this.file.grammar,this.parseTable,t)},t.prototype.printError=function(t,e){for(var n=0,r=this.errors;n<r.length;n++){var s=r[n];t.writeln(s.toString(e))}t.writeln()},t.prototype.printWarning=function(t,e){for(var n=0,r=this.warnings;n<r.length;n++){var s=r[n];t.writeln(s.toString(e))}t.writeln()},t.prototype.hasWarning=function(){return this.warnings.length>0},t.prototype.hasError=function(){return this.errors.length>0},t.prototype.warningSummary=function(){return this.warnings.length+" warning(s), "+this.errors.length+" error(s)"},t.prototype.getTemplateInput=function(){return{prefix:"jj",endl:"\n",opt:this.file.opt,header:this.file.header,extraArg:this.file.extraArgs,g:this.file.grammar,pt:this.parseTable,sematicType:this.file.sematicType,dfas:this.file.lexDFA}},t}();var Dt={};Ot=function(t,e){!function(t,e){i("/*"),i("    generated by jscc, an LALR(1) parser generator made by hadroncfy."),i("    template for typescript, written by hadroncfy, aussi."),i("*/"),s(t.header);var n=t.prefix,r=t.opt.tab||"    ";function s(t){e.write(t)}function i(t){e.writeln(t)}function a(t,e){return(t.length<e?function(t,e){for(var n="";e-- >0;)n+=t;return n}(" ",e-t.length):"")+t}function o(e,o,h,c,l){var u=1;i(""),s("let "),s(n+e),i(" = [ "),s(r);for(var p=0,f=o;p<f.length;p++)s(a(l(f[p]),h)),s(","),u++>=c&&(u=1,s(t.endl+r));i(""),s("]; ")}function c(t){function e(t){var e=[];return t.chars.forEach(function(t,n){t===n?e.push("c === "+t):0===t&&n!==h.oo?e.push("c <= "+n):0!==t&&n===h.oo?e.push("c >= "+t):0!==t&&n!==h.oo?e.push("(c >= "+t+" && c <= "+n+")"):e.push("true")}),e.join(" || ")}var n=!0;i(""),s("        case "),s(t.index),i(":"),s("            ret.hasArc = "),s(t.arcs.length>0?"true":"false"),i(";"),s("            ret.isEnd = "),s(null===t.endAction?"false":"true"),s(";");for(var r=0,a=t.arcs;r<a.length;r++){var o=a[r];n?(i(""),s("            if("),s(e(o)),i("){"),s("                ret.state = "),s(o.to.index),i(";"),s("            }"),n=!1):(i(""),s("            else if("),s(e(o)),i("){"),s("                ret.state = "),s(o.to.index),i(";"),s("            }"))}0===t.arcs.length?(i(""),s("            ret.state = -1;")):(i(""),i("            else {"),i("                ret.state = -1;"),s("            }")),i(""),s("            break;")}function l(t,e){i(""),s("function moveDFA"),s(e),i("(c: number, ret: { state: number, hasArc: boolean, isEnd: boolean }){"),s("    switch(ret.state){");for(var n=0,r=t.states;n<r.length;n++)c(r[n]);i(""),i("        default:"),i("            ret.state = -1;"),i("            ret.hasArc = false;"),i("    }"),s("}")}function u(t,e){o("lexTokens"+e,t.states,6,10,function(t){return t.endAction?function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(-1!==r.token)return r.token}return-1}(t.endAction.data).toString():"-1"})}i(""),i(""),i("/*"),i("    find the next state to go in the dfa"),s("*/");for(var p=0,f=t.dfas;p<f.length;p++)l(f[p],p);i(""),i(""),i("/*"),i("    all the lexer data goes here."),i("*/"),s("let "),s(n),s("lexers = [");for(p=0;p<t.dfas.length;p++)i(""),s("    moveDFA"),s(p),s(",");i(""),i("];"),i(""),i("/*"),i("    tokens that a lexical dfa state can return"),s("*/");for(p=0,f=t.dfas;p<f.length;p++)u(f[p],p);i("");var d=t.pt;i(""),s("let "),s(n),s("stateCount = "),s(d.stateCount),i(";"),s("let "),s(n),s("tokenCount = "),s(t.g.tokens.length),i(";"),s("let "),s(n),s("actERR = "),s(d.stateCount+1),i(";"),i("/*"),s("    compressed action table: action = "),s(n),s("pact["),s(n),i("disact[STATE-NUM] + TOKEN]"),i("    when action > 0, shift the token and goto state (action - 1);"),i("    when action < 0, reduce with rule (1-action);"),i("    when action = 0, do default action."),s("*/"),o("pact",d.pact,6,10,function(t){return null===t?"0":t===H.NULL?String(d.stateCount+1):t.actionType===U.SHIFT?(t.shift.stateIndex+1).toString():t.actionType===U.REDUCE?(-t.rule.index-1).toString():void 0}),i(""),i("/*"),i("    displacement of action table."),s("*/"),o("disact",d.disact,6,10,function(t){return t.toString()}),i(""),i("/*"),s("    used to check if a position in "),s(n),i("pact is out of bouds."),s("    if "),s(n),s("checkact["),s(n),i("disact[STATE-NUM] + TOKEN] = STATE-NUM, this position is not out of bounds."),s("*/"),o("checkact",d.checkact,6,10,function(t){return void 0===t?"0":t.toString()}),i(""),i("/*"),s("    default action table. action = "),s(n),i("defred[STATE-NUM],"),i("    where action is the number of the rule to reduce with."),s("*/"),o("defred",d.defred,6,10,function(t){return t.toString()}),i(""),i("/*"),s("    compressed goto table: goto = "),s(n),s("pgoto["),s(n),i("disgoto[STATE-NUM] + NON_TERMINAL]"),s("*/"),o("pgoto",d.pgoto,6,10,function(t){return null===t?"-1":t.shift.stateIndex.toString()}),i(""),i("/*"),i("    displacement of the goto table"),s("*/"),o("disgoto",d.disgoto,6,10,function(t){return t.toString()}),i(""),i("/*"),s("    length of each rule: rule length = "),s(n),i("ruleLen[RULE-NUM]"),s("*/"),o("ruleLen",d.g.rules,6,10,function(t){return t.rhs.length.toString()}),i(""),i("/*"),i("    index of the LHS of each rule"),s("*/"),o("lhs",d.g.rules,6,10,function(t){return t.lhs.index.toString()}),i(""),i("/*"),i("    token names"),s("*/"),o("tokenNames",d.g.tokens,20,3,function(t){return'"'+t.sym+'"'}),i(""),i("/*"),i("    token alias"),s("*/"),o("tokenAlias",d.g.tokens,20,3,function(t){return t.alias?'"'+t.alias+'"':"null"});var _=t.opt.className||"Parser";i("");function v(t,e){var r={addBlock:function(t,e){i(""),s("                "),s(t.replace(/\$token/g,"this._token").replace(/\$\$/g,"this._sematicVal"))},pushLexState:function(t){i(""),s("                this._lexState.push("),s(t),s(");")},popLexState:function(){i(""),s("                this._lexState.pop();")},setImg:function(t){i(""),s('                this._setImg("'),s(t),s('");')},returnToken:function(t){i(""),i("                this._token = {"),s("                    id: "),s(t.index),i(","),i("                    val: this._matched.join('')"),s("                };")}};function a(t){for(var e=0,n=t;e<n.length;e++)if(-1===n[e].token)return!0;return!1}var o=n+"staten";i(""),s("    private _doLexAction"),s(e),s("("),s(o),i(": number){"),s("        let "),s(n),s("tk = "),s(n),s("lexTokens"),s(e),s("["),s(o),i("];"),s("        "),s(n),s("tk !== -1 && this._prepareToken("),s(n),i("tk);"),s("        switch("),s(o),s("){");for(var h=0,c=t.states;h<c.length;h++)if(null!==c[h].endAction&&a(c[h].endAction.data)){i(""),s("            case "),s(h),s(":");for(var l=0,u=c[h].endAction.data;l<u.length;l++){var p=u[l];-1===p.token&&p.toCode(r)}i(""),s("                break;")}i(""),i("            default:;"),i("        }"),s("    }")}i(""),i(""),i("export function tokenToString(tk: number){"),s("    return "),s(n),s("tokenAlias[tk] === null ? `<${"),s(n),s('tokenNames[tk]}>` : `"${'),s(n),i('tokenAlias[tk]}"`;'),i("}"),i(""),i("export class Token {"),i("    constructor("),i("        public id: number,"),i("        public val: string,"),i("        public startLine: number,"),i("        public startColumn: number,"),i("        public endLine: number,"),i("        public endColumn: number"),i("    ){}"),i("    clone(){"),i("        return new Token("),i("            this.id,"),i("            this.val,"),i("            this.startLine,"),i("            this.startColumn,"),i("            this.endLine,"),i("            this.endColumn"),i("        );"),i("    }"),i("    toString(){"),s("        return ("),s(n),i("tokenAlias[this.id] === null ? "),s("            `<${"),s(n),i("tokenNames[this.id]}>` :"),s('            `"${'),s(n),i('tokenAlias[this.id]}"`) + `("${this.val}")`;'),i("    }"),s("}");var g=t.sematicType||"any";i(""),s("export class "),s(_),i(" {"),i("    // members for lexer"),i("    private _lexState: number[];"),i("    private _state: number;"),i("    private _matched: string;"),i("    private _token: Token;"),i("    "),i("    private _marker: { state: number, line: number, column: number } = { state: -1, line: 0, column: 0 };"),i("    private _backupCount: number;"),i(""),i("    private _line: number;"),i("    private _column: number;"),i("    private _tline: number;"),i("    private _tcolumn: number;"),i(""),i("    // members for parser"),i("    private _lrState: number[] = [];"),s("    private _sematicS: "),s(g),i("[] = [];"),s("    private _sematicVal: "),s(g),i(";"),i(""),i("    private _stop;"),i(""),i("    private _handlers: {[s: string]: ((a1?, a2?, a3?) => any)[]} = {};"),i(""),i("    // extra members, defined by %extra_arg"),s("    "),s(t.extraArg),i(""),i(""),i("    constructor(){"),i("        this.init();"),i("    }"),i("    init(){"),i("        this._lexState = [ 0 ];// DEFAULT"),i("        this._state = 0;"),i("        this._matched = '';"),i("        this._token = new Token(-1, null, 0, 0, 0, 0);"),i("        this._marker.state = -1;"),i("        this._backupCount = 0;"),i("        this._line = this._tline = 1;"),i("        this._column = this._tcolumn = 1;"),i("        "),i("        this._lrState = [ 0 ];"),i("        this._sematicS = [];"),i("        this._sematicVal = null;"),i(""),i("        this._stop = false;"),i("    }"),i("    /**"),i("     *  set "),i("     */"),i("    private _setImg(s: string){"),i("        this._matched = s;"),i("        this._tline = this._line;"),i("        this._tcolumn = this._column;"),i("    }"),i("    private _prepareToken(tid: number){"),i("        this._token.id = tid;"),i("        this._token.val = this._matched;"),i("        this._token.startLine = this._tline;"),i("        this._token.startColumn = this._tcolumn;"),i("        this._token.endLine = this._line;"),i("        this._token.endColumn = this._column;"),i(""),i("        this._matched = '';"),i("        this._tline = this._line;"),i("        this._tcolumn = this._column;"),i("    }"),i("    private _returnToken(){"),s("        this._emit('token', "),s(n),i("tokenNames[this._token.id], this._token.val);"),i("        while(!this._stop && !this._acceptToken(this._token));"),i("        this._token.id = -1;"),i("    }"),i("    private _emit(name: string, a1?, a2?, a3?){"),i("        let cbs = this._handlers[name];"),i("        if(cbs){"),i("            for(let cb of cbs){"),i("                cb(a1, a2, a3);"),i("            }"),i("        }"),i("    }"),i("    on(name: string, cb: (a1?, a2?, a3?) => any){"),i("        this._handlers[name] || (this._handlers[name] = []);"),i("        this._handlers[name].push(cb);"),s("    }");for(p=0,f=t.dfas;p<f.length;p++)v(f[p],p);i(""),i("    /**"),i("     *  do a lexical action"),i("     *  @api private"),i("     *  @internal"),i("     */"),i("    private _doLexAction(lexstate: number, state: number){"),s("        switch(lexstate){");for(p=0;p<t.dfas.length;p++)i(""),s("            case "),s(p),i(":"),s("                this._doLexAction"),s(p),i("(state);"),s("                break;");i(""),i("            default:;"),i("        }"),i("        this._token.id !== -1 && this._returnToken();"),i("    }"),i("    private _rollback(){"),i("        let ret = this._matched.substr(this._matched.length - this._backupCount, this._backupCount);"),i("        this._matched = this._matched.substr(0, this._matched.length - this._backupCount);"),i("        this._backupCount = 0;"),i("        this._line = this._marker.line;"),i("        this._column = this._marker.column;"),i("        this._state = this._marker.state;"),i("        this._marker.state = -1;"),i("        return ret;"),i("    }"),i("    private _mark(){"),i("        this._marker.state = this._state;"),i("        this._marker.line = this._line;"),i("        this._marker.column = this._column;"),i("        this._backupCount = 0;"),i("    }"),i("    /**"),i("     *  accept a character"),i("     *  @return - true if the character is consumed, false if not consumed"),i("     *  @api private"),i("     *  @internal"),i("     */"),i("    private _acceptChar(c: string){"),s("        function consume(cela: "),s(_),i(", c: string){"),i("            c === '\\n' ? (cela._line++, cela._column = 0) : (cela._column++);"),i("            cela._matched += c;"),i("            cela._marker.state !== -1 && (cela._backupCount++);"),i("            return true;"),i("        }"),i("        let lexstate = this._lexState[this._lexState.length - 1];"),i("        let retn = { state: this._state, hasArc: false, isEnd: false };"),s("        "),s(n),i("lexers[lexstate](c.charCodeAt(0), retn);"),i("        if(retn.isEnd){"),i("            // if current state is a terminate state, be careful"),i("            if(retn.hasArc){"),i("                if(retn.state === -1){"),i("                    // nowhere to go, stay where we are"),i("                    this._doLexAction(lexstate, this._state);"),i("                    // recover"),i("                    this._marker.state = -1;"),i("                    this._backupCount = 0;"),i("                    this._state = 0;                    "),i("                    // character not consumed"),i("                    return false;"),i("                }"),i("                else {"),i("                    // now we can either go to that new state, or stay where we are"),i("                    // it is prefered to move forward, but that could lead to errors,"),i("                    // so we need to memorize this state before move on, in case if "),i("                    // an error occurs later, we could just return to this state."),i("                    this._mark();"),i("                    this._state = retn.state;"),i("                    return consume(this, c);"),i("                }"),i("            }"),i("            else {"),i("                // current state doesn't lead to any state, just stay here."),i("                this._doLexAction(lexstate, this._state);"),i("                // recover"),i("                this._marker.state = -1;"),i("                this._backupCount = 0;"),i("                this._state = 0;"),i("                // character not consumed"),i("                return false;"),i("            }"),i("        }"),i("        else {"),i("            if(retn.state === -1){"),i("                // nowhere to go at current state, error may have occured."),i("                // check marker to verify that"),i("                if(this._marker.state !== -1){"),i("                    // we have a previously marked state, which is a terminate state."),i("                    let s = this._rollback();"),i("                    this._doLexAction(lexstate, this._state);"),i("                    this._state = 0;"),i("                    this.accept(s);"),i("                    // character not consumed"),i("                    return false;"),i("                }"),i("                else {"),i("                    // error occurs"),i("                    this._emit('lexicalerror', `unexpected character \"${c}\"`, this._line, this._column);"),i("                    // force consume"),i("                    return true;"),i("                }"),i("            }"),i("            else {"),i("                this._state = retn.state;"),i("                // character consumed"),i("                return consume(this, c);"),i("            }"),i("        }"),i("    }"),i("    private _acceptEOF(){"),i("        if(this._state === 0){"),i("            // recover"),i("            this._prepareToken(0);"),i("            this._returnToken();"),i("            return true;"),i("        }"),i("        else {"),i("            let lexstate = this._lexState[this._lexState.length - 1];"),i("            let retn = { state: this._state, hasArc: false, isEnd: false };"),s("            "),s(n),i("lexers[lexstate](-1, retn);"),i("            if(retn.isEnd){"),i("                this._doLexAction(lexstate, this._state);"),i("                this._state = 0;"),i("                this._marker.state = -1;"),i("                return false;"),i("            }"),i("            else if(this._marker.state !== -1){"),i("                let s = this._rollback();"),i("                this._doLexAction(lexstate, this._state);"),i("                this._state = 0;"),i("                this.accept(s);"),i("                return false;"),i("            }"),i("            else {"),i("                this._emit('lexicalerror', 'unexpected end of file');"),i("                return true;"),i("            }"),i("        }"),i("    }"),i("    /**"),i("     *  input a string"),i("     *  @api public"),i("     */"),i("    accept(s: string){"),i("        for(let i = 0; i < s.length && !this._stop;){"),i("            this._acceptChar(s.charAt(i)) && i++;"),i("        }"),i("    }"),i("    /**"),i("     *  tell the compiler that end of file is reached"),i("     *  @api public"),i("     */"),i("    end(){"),i("        while(!this._stop && !this._acceptEOF());"),i("        this._stop = true;"),i("    }"),i("    halt(){"),i("        this._stop = true;"),s("    }");i(""),s("    private _doReduction("),s(n),i("rulenum: number){"),s("        let "),s(n),s("nt = "),s(n),s("lhs["),s(n),i("rulenum];"),s("        let "),s(n),i("sp = this._sematicS.length;"),s("        let "),s(n),s("top = this._sematicS["),s(n),s("sp - "),s(n),s("ruleLen["),s(n),i("rulenum]] || null;"),s("        switch("),s(n),s("rulenum){"),function(){for(var e={addBlock:function(t,e){i(""),s("                {"),s(t.replace(/\$\$/g,n+"top")),s("}")},pushLexState:function(t){i(""),s("                this._lexState.push("),s(t),s(");")},popLexState:function(){i(""),s("                this._lexState.pop();")},setImg:function(t){i(""),s('                this._setImg("'),s(t),s('");')},returnToken:function(t){i(""),i("                this._token = {"),s("                    id: "),s(t.index),i(","),i("                    val: this._matched.join('')"),s("                };")}},r=0,a=t.g.rules;r<a.length;r++){var o=a[r];if(null!==o.action){i(""),s("            case "),s(o.index),i(":"),s("                /* "),s(o.toString()),s(" */");for(var h in o.vars)i(""),s("                var "),s(h),s(" = this._sematicS["),s(n),s("sp - "),s(o.rhs.length-o.vars[h].val),s("];");for(var c in o.usedVars)i(""),s("                var "),s(c),s(" = this._sematicS["),s(n),s("sp - "),s(o.usedVars[c].val),s("];");for(var l=0,u=o.action;l<u.length;l++)u[l].toCode(e);i(""),s("                break;")}}}(),i(""),i("        }"),s("        this._lrState.length -= "),s(n),s("ruleLen["),s(n),i("rulenum];"),s("        let "),s(n),i("cstate = this._lrState[this._lrState.length - 1];"),s("        this._lrState.push("),s(n),s("pgoto["),s(n),s("disgoto["),s(n),s("cstate] + "),s(n),i("nt]);"),i(""),s("        this._sematicS.length -= "),s(n),s("ruleLen["),s(n),i("rulenum];"),s("        this._sematicS.push("),s(n),i("top);"),i("    }"),i(""),i("    private _acceptToken(t: Token){"),i("        // look up action table"),i("        let cstate = this._lrState[this._lrState.length - 1];"),s("        let ind = "),s(n),i("disact[cstate] + t.id;"),i("        let act = 0;"),s("        if(ind < 0 || ind >= "),s(n),s("pact.length || "),s(n),i("checkact[ind] !== cstate){"),s("            act = -"),s(n),i("defred[cstate] - 1;"),i("        }"),i("        else {"),s("            act = "),s(n),i("pact[ind];"),i("        }"),s("        if(act === "),s(n),i("actERR){"),i("            // explicit error"),i("            this._syntaxError(t);"),i("            return true;"),i("        }"),i("        else if(act > 0){"),i("            // shift"),i("            if(t.id === 0){"),i("                // end of file"),i("                this._stop = true;"),i("                this._emit('accept');"),i("                return true;"),i("            }"),i("            else {"),i("                this._lrState.push(act - 1);"),i("                this._sematicS.push(this._sematicVal);"),i("                this._sematicVal = null;"),i("                // token consumed"),i("                return true;"),i("            }"),i("        }"),i("        else if(act < 0){"),i("            this._doReduction(-act - 1);"),i("            return false;"),i("        }"),i("        else {"),i("            // error"),i("            this._syntaxError(t);"),i("            // force consume"),i("            return true;"),i("        }"),i("    }"),i("    private _syntaxError(t: Token){"),i("        let msg = `unexpected token ${t.toString()}, expecting one of the following token(s):\\n`"),i("        msg += this._expected(this._lrState[this._lrState.length - 1]);"),i('        this._emit("syntaxerror", msg, t);'),i("    }"),i("    private _expected(state: number){"),s("        let dis = "),s(n),i("disact[state];"),i("        let ret = '';"),i("        function expect(tk: number){"),i("            let ind = dis + tk;"),s("            if(ind < 0 || ind >= "),s(n),s("pact.length || state !== "),s(n),i("checkact[ind]){"),s("                return "),s(n),i("defred[state] !== -1;"),i("            }"),i("            else {"),i("                return true;"),i("            }"),i("        }"),s("        for(let tk = 0; tk < "),s(n),i("tokenCount; tk++){"),i("            expect(tk) && (ret += `    ${tokenToString(tk)} ...` + '\\n');"),i("        }"),i("        return ret;"),i("    }"),s("}")}(t,e),e.save(".ts")},Dt["typescript"]=Ot;var Ot,Ft=Object.freeze({compress:tt,IntervalSet:p});t.Pattern=B,t.io=S,t.debug=Ft,t.setDebugger=function(t){return a.log=t.log},t.setTab=function(t){return i=t},t.genResult=function(t){var e=new Vt,n=function(t,e){var n=new It,r=!1;return n.on("lexicalerror",function(e,s,i){t.err(new N(e,s)),n.halt(),r=!0}),n.on("syntaxerror",function(e,s){t.err(new N(e,s.startLine)),n.halt(),r=!0}),n.gb=new ft(t),n.accept(e),n.end(),r?null:n.gb.build()}(e,t);if(e.hasError())return e.terminated=!0,e;var r=n.grammar;e.file=n;for(var s=0,i=r.tokens;s<i.length;s++){var o=i[s];o.used||e.warn(new I("token <"+o.sym+"> is never used (defined at line "+o.line+")"))}for(var h=0,c=r.nts;h<c.length;h++){var l=c[h];l.used||e.warn(new I('non terminal "'+l.sym+'" is unreachable'))}if(e.hasError())return e.terminated=!0,e;r.genFirstSets();var u=X(r);e.itemSets=u.result,e.iterationCount=u.iterations;var p=function(t,e){var n=[];function r(e,r,s){var i=t.tokens[r.getShift()];if(i.assoc!==G.UNDEFINED){var o=s.rule.pr;if(-1!==o){if(o>i.pr)return s;if(o<i.pr)return r;if(i.assoc===G.LEFT)return s;if(i.assoc===G.RIGHT)return r;if(i.assoc===G.NON)return H.NULL;a.assert(!1)}}var h=new Q;return h.type=q.SR,h.set=e,h.token=i,h.used=r,h.discarded=s,n.push(h),r}function s(e,r,s,i){var a=t.tokens[i];if(-1!==r.rule.pr&&-1!==s.rule.pr&&r.rule.pr!==s.rule.pr)return r.rule.pr>s.rule.pr?r:s;var o=r.rule.index>s.rule.index?s:r,h=r.rule.index>s.rule.index?r:s,c=new Q;return c.type=q.RR,c.set=e,c.token=a,c.used=o,c.discarded=h,n.push(c),o}var i=new W(t,e.size);return e.forEach(function(e){e.forEach(function(n){if(n.actionType===U.SHIFT){var o=n.getShift();if(t.isToken(o)){var h=e.stateIndex*t.tokenCount+o;null!==(l=i.shift[h])?l.actionType===U.REDUCE?i.shift[h]=r(e,n,l):a.assert(l.shift===n.shift):i.shift[h]=n}else h=e.stateIndex*t.nts.length+(-o-1),i.gotot[h]=n}else if(n.actionType===U.REDUCE){for(var c=0;c<t.tokenCount;c++)if(n.lah.contains(c+1)){var l,u=e.stateIndex*t.tokenCount+c;null!==(l=i.shift[u])?l.actionType===U.REDUCE?i.shift[u]=s(e,l,n,c):l.actionType===U.SHIFT&&(i.shift[u]=r(e,l,n)):i.shift[u]=n}}else a.assert(!1)})}),{result:i,conflicts:n}}(r,e.itemSets);p.result.findDefAct(),e.parseTable=new nt(p.result);for(var f=0,d=p.conflicts;f<d.length;f++){var _=d[f];e.warn(new I(_.toString()))}return e},t.generateCode=function(t,e,n,r){if(void 0===Dt[t])throw'template for language "'+t+'" is not implemented yet';Dt[t](e,n)},Object.defineProperty(t,"__esModule",{value:!0})});
