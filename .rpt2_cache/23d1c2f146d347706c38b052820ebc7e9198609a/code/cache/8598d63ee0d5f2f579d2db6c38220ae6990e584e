{"code":"import { biss } from '../util/io.js';\r\nvar DFA = (function () {\r\n    function DFA(states, actions) {\r\n        this.states = states;\r\n        this.actions = actions;\r\n        this.start = states[0];\r\n    }\r\n    DFA.prototype.toString = function () {\r\n        var ret = '';\r\n        for (var i = 0; i < this.states.length; i++) {\r\n            ret += this.states[i].toString() + '\\n';\r\n        }\r\n        return ret;\r\n    };\r\n    DFA.prototype.matcher = function (stream) {\r\n        var bs = biss(stream);\r\n        var backups = [];\r\n        var matched = [];\r\n        var marker = null;\r\n        var c = bs.peek();\r\n        var cs;\r\n        function nc() {\r\n            if (marker !== null) {\r\n                backups.push(c);\r\n            }\r\n            matched.push(c);\r\n            bs.next();\r\n            c = bs.peek();\r\n        }\r\n        function rollback() {\r\n            cs = marker;\r\n            marker = null;\r\n            while (backups.length > 0) {\r\n                bs.backup(backups.pop());\r\n                matched.pop();\r\n            }\r\n        }\r\n        var cela = this;\r\n        return function () {\r\n            c = bs.peek();\r\n            cs = cela.start;\r\n            matched.length = 0;\r\n            backups.length = 0;\r\n            marker = null;\r\n            var ns;\r\n            while (true) {\r\n                if (cs.endAction !== null) {\r\n                    if (cs.hasArc()) {\r\n                        ns = c !== null ? cs.getState(c.charCodeAt(0)) : null;\r\n                        if (ns === null) {\r\n                            return { matched: matched.join(''), action: cs.endAction };\r\n                        }\r\n                        else {\r\n                            backups.length = 0;\r\n                            marker = cs;\r\n                            cs = ns;\r\n                            nc();\r\n                        }\r\n                    }\r\n                    else {\r\n                        return { matched: matched.join(''), action: cs.endAction };\r\n                    }\r\n                }\r\n                else {\r\n                    ns = c !== null ? cs.getState(c.charCodeAt(0)) : null;\r\n                    if (ns === null) {\r\n                        if (marker !== null) {\r\n                            rollback();\r\n                            return { matched: matched.join(''), action: cs.endAction };\r\n                        }\r\n                        else if (c === null) {\r\n                            return null;\r\n                        }\r\n                        else {\r\n                            throw new Error('unexpected character \"' + c + '\"');\r\n                        }\r\n                    }\r\n                    else {\r\n                        cs = ns;\r\n                        nc();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    };\r\n    return DFA;\r\n}());\r\nexport { DFA };\r\n//# sourceMappingURL=dfa.js.map","map":{"version":3,"file":"dfa.js","sourceRoot":"","sources":["../src/lexer/dfa.ts"],"names":[],"mappings":"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"}}
